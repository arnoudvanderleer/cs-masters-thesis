\chapter{Algebraic Structures}\label{ch:algebraic-structures}

In his paper, Hyland uses concepts from universal algebra to study the $ \lambda $-calculus. This chapter introduces these concepts: it consecutively introduces algebraic theories (Section \ref{sec:algebraic-theories}), algebras (Section \ref{sec:algebras}), presheaves (Section \ref{sec:presheaves}) and $ \lambda $-theories (Section \ref{sec:lambda-theories}). The last part of this chapter, Section \ref{sec:algebraic-theory-examples}, is devoted to examples, so it may be useful to skip back and forth a couple of times to get a better understanding of what the definitions are about.

\section{Algebraic Theories}\label{sec:algebraic-theories}

\begin{definition}[\coqident{AlgebraicTheories.AlgebraicTheories}{algebraic_theory}]
  We define an \iindex{algebraic theory} $ T $ to be a sequence of sets $ T_n $ indexed over $ \mathbb N $ with for all $ 1 \leq i \leq n $ elements ("variables" or "projections") $ x_{n, i}: T_n $ (we often leave $ n $ implicit and write $ x_i $), together with a substitution operation
  \[ \_ \bullet \_: T_m \times T_n^m \to T_n \]
  for all $ m $ and $ n $, such that
  \begin{align*}
    x_j \bullet g &= g_j\\
    f \bullet (x_{l, i})_i &= f\\
    (f \bullet g) \bullet h &= f \bullet (g_i \bullet h)_i
  \end{align*}
  for all $ 1 \leq j \leq l $, $ f: T_l $, $ g: T_m^l $ and $ h: T_n^m $.
\end{definition}

\begin{remark}
  For equivalent definitions of different kinds, see Chapter \ref{ch:alternative-definitions}.
\end{remark}

\begin{definition}[\coqident{AlgebraicTheories.AlgebraicTheoryMorphism}{algebraic_theory_morphism}]
  A \textit{morphism}\index{algebraic theory!morphism} $ f $ between algebraic theories $ T $ and $ T^\prime $ is a sequence of functions $ f_n: T_n \to T^\prime_n $ (we usually leave the $ n $ implicit and just write $ f $ if the context is clear) such that
  \begin{align*}
    f_n(x_j) &= x_j\\
    f_n(s \bullet t) &= f_m(s) \bullet (f_n(t_i))_i
  \end{align*}
  for all $ 1 \leq j \leq n $, $ s: T_m $ and $ t: T_n^m $.
\end{definition}

Together, these form the category of algebraic theories \iindex{$ \AlgTh $} (\coqident{AlgebraicTheories.AlgebraicTheoryCategoryCore}{algebraic_theory_cat}).

\begin{lemma}[\coqident{AlgebraicTheories.AlgebraicTheoryCategory}{limits_algebraic_theory_cat}]\label{rem:algebraic-theory-limits}
  We can construct binary products of algebraic theories, with sets $ (T \times T^\prime)_n = T_n \times T^\prime_n $, variables $ (x_i, x^\prime_i) $ and substitution
  \[ (f, f^\prime) \bullet (g, g^\prime) = (f \bullet g, f^\prime \bullet g^\prime). \]
  In the same way, the category of algebraic theories has all limits.

  Note that the forgetful functor $ F: \AlgTh \to \SET^{\mathbb N} $ (where $ \SET^{\mathbb N} $ is the category of `sequences of sets' $ (T_n)_n $) creates limits, since any diagram $ D $ has a limit and the underlying set of the limit of $ D $ is the limit of the underlying sets of the objects in $ D $.
\end{lemma}

\begin{lemma}[\coqident{AlgebraicTheories.AlgebraicTheoryCategory}{is_univalent_algebraic_theory_cat}]
  Since an isomorphism of algebraic theories $ S \cong T $ consists of pointwise bijections $ f_n: S_n \cong T_n $ that respect the variables and substitution, the category of algebraic theories is univalent.
\end{lemma}

Later on, we will see an example of a trivial algebraic theory (the terminal theory) $ T $, in which every $ T_n $ only contains one element. Now, there are many different nontrivial algebraic theories, and it is not easy to find properties that every algebraic theory must satisfy. However, to explore their general structure a little bit, we can show that their variables are distinct, and so every $ T_n $ has at least $ n $ distinct elements. Therefore, no nontrivial algebraic theory is `almost trivial', if almost trivial means having some $ N $ such that every $ T_n $ has at most $ N $ elements.
\begin{lemma}\label{lem:nontrivial-algebraic-theory}
  Let $ T $ be an algebraic theory, such that $ T_n $ has at least two distinct elements for some $ n $. Then for all $ 1 \leq i, j \leq m $ with $ i \not = j $, we have $ x_i \not = x_j $.
\end{lemma}
\begin{proof}
  We can also formulate the statement as: If there exist $ 1 \leq i, j \leq m $ with $ i \not = j $ such that $ x_i = x_j $, then every $ T_n $ contains at most one distinct element.

  So, suppose that $ x_i = x_j $ for some $ i \not = j $. For $ a, b : T_n $, we define $ v : T_n^m $ as
  \[ v_k = \left\{\begin{array}{ll} a & k = i\\ b & k \not = i \end{array}\right., \]
  so in particular, $ v_j = b $. Then we have
  \[ a = v_i = x_i \bullet v = x_j \bullet v = v_j = b, \]
  so every $ T_n $ contains exactly one element, and $ T $ is trivial.
\end{proof}

Now, there are also a lot of other, equivalent ways to define the objects that we call `algebraic theories' here. For a couple of these alternative definitions, see Chapter \ref{ch:alternative-definitions}. In particular, an algebraic theory is equivalent to a category $ \L $ with $ \L_0 = \mathbb N $ where the object $ n $ is $ 1^n $, the $ n $-fold product of $ 1 $.

\section{Algebras}\label{sec:algebras}

\begin{definition}[\coqident{AlgebraicTheories.Algebras}{algebra}]
  An \iindex{algebra} $ A $ for an algebraic theory $ T $ is a set $ A $, together with an action
  \[ \bullet: T_n \times A^n \to A \]
  for all $ n $, such that
  \begin{align*}
    x_j \bullet a &= a_j\\
    (f \bullet g) \bullet a &= f \bullet (g_i \bullet a)_i
  \end{align*}
  for all $ j $, $ f: T_m $, $ g: T_n^m $ and $ a: A^n $.
\end{definition}

\begin{definition}[\coqident{AlgebraicTheories.AlgebraMorphisms}{algebra_morphism}]
  For an algebraic theory $ T $, a \textit{morphism}\index{algebra!morphism} $ f $ between $ T $-algebras $ A $ and $ A^\prime $ is a function $ f: A \to A $ such that
  \[ f(t \bullet a) = f \bullet (f(a_i))_i \]
  for all $ t: T_n $ and $ a: A^n $.
\end{definition}

Together, these form the category of $ T $-algebras \iindex{$ \Alg T $} (\coqident{AlgebraicTheories.AlgebraCategoryCore}{algebra_cat}).

\begin{remark}
  The category of algebras has all limits. The set of a limit of algebras is the limit of the underlying sets, so the forgetful functor to the category of sets creates limits.
\end{remark}

\begin{lemma}[\coqident{AlgebraicTheories.AlgebraCategory}{is_univalent_algebra_cat}]
  Just like with algebraic theories, the category of $ T $-algebras is univalent because its (iso)morphisms preserve $ \bullet $.
\end{lemma}

\begin{remark}
  The notions of algebraic theories and their algebras stem from the field of \iindex{universal algebra}. In universal algebra, one studies the `collections of algebraic structures'. For example, the collection of monoids: a monoid is a set with an associative binary operation and an identity element. Other examples of collections are those of abelian monoids, (abelian) groups or (commutative) rings. As we will see in Example \ref{ex:free-monoid-theory}, one can construct an algebraic theory $ T $ such that the category of monoids is equivalent to $ \Alg T $, and we can do very similar things for the other structures mentioned. Therefore, one could say that universal algebra studies algebraic theories and their algebras (or `models').

  Any category that is equivalent to $ \Alg T $ for some algebraic theory $ T $ is called \iindex{algebraic}. For example, in Remark \ref{rem:free-theory-algebra-set}, we will see that $ \SET $ is algebraic. By the remark above, an algebraic category has all limits. It turns out that it also has all colimits (see Lemma \ref{lem:algebra-coproducts} for binary coproducts, or \autocite{algebraic-theories-2010}, Part 1, Theorem 4.5 for general colimits). Note, however, that the proof for colimits is a lot more complicated than the proof for limits, just like colimits of algebraic objects usually are more complicated than limits. For example, consider (binary) products and coproducts of groups.

  Note that this means that any category that does not have all limits or colimits, is not algebraic. For example, the category of fields (commutative rings that also have a division operation) is not algebraic: the product $ \mathbb Q \times \mathbb F_p $ does not exist, because there is no (product) field that has morphisms to fields of different characteristic.
\end{remark}

\begin{definition}[\coqident{AlgebraicTheories.AlgebraCategory}{algebra_pullback}]\label{def:algebra-pullback}
  If we have a morphism of algebraic theories $ f: T^\prime \to T $, we have a \textit{pullback functor of algebras}\index{pullback functor!of algebras} $ f^* : \Alg T \to \Alg {T^\prime} $. It endows $ T $-algebras with an action from $ T^\prime $ given by $ g \bullet_{T^\prime} a = f(g) \bullet_T a $. Then $ T $-algebra morphisms commute with this $ T^\prime $-action, so we indeed have a functor.
\end{definition}

\begin{remark}
  Note that by Lemma \ref{lem:lawvere-algebra}, algebras for $ T $ are equivalent to finite-product-preserving functors from its Lawvere theory to $ \SET $. Then $ f: T^\prime \to T $ corresponds to a functor on the Lawvere theories $ \mathbf L_f: \mathbf L_{T^\prime} \to \mathbf L_T $, and $ f^*: \Alg T \to \Alg{T^\prime} $ corresponds to precomposition with $ \mathbf L_f $:
  \begin{center}
    \begin{tikzcd}
      \mathbf L_{T^\prime} \arrow[r, "{\mathbf L_f}"] \arrow[rd, dashed] & \mathbf L_T \arrow[d]\\
      & \SET
    \end{tikzcd}
  \end{center}
\end{remark}

Actually, we can recover some information about the algebraic theory morphism from this pullback functor. For example,
\begin{lemma}\label{lem:algebra-pullback-equivalence}
  If $ f^* $ is an equivalence of categories, $ f $ is an isomorphism.
\end{lemma}
\begin{proof}
  This proof uses the theory algebra, which will be properly defined in Example \ref{ex:theory-algebra}.

  Note that to show that $ f $ is an isomorphism, we only need to show that the $ f_n $ are bijections. From the fact that we have inverse functions $ g_n : \SET(T, T^\prime) $ for the $ f_n $, and the fact that $ f $ is an algebraic theory morphism, we know that $ (g_n)_n $ is an algebraic theory morphism as well, and that it is the inverse of $ f $.

  First of all, note that for all $ n : \mathbb N $ and $ A : \Alg T $, the following diagram in $ \SET $ commutes:
  \begin{center}
    \begin{tikzcd}
      \Alg T(T_n, A) \arrow[r, "f^*"] \arrow[d, "\sim"] & \Alg{T^\prime}(f^* T_n, f^* A) \arrow[d, "\overline f_n \cdot -"]\\
      A^n \arrow[r, "\sim"] & \Alg{T^\prime}(T^\prime_n, f^* A)
    \end{tikzcd}
  \end{center}
  % \[ (g : T_n \to B) \mapsto (g: T_n \to B) \mapsto (f \cdot g : T^\prime_n \to B) \]
  % \[ (g : T_n \to B) \mapsto ((g x_i)_i : B^n) \mapsto (s \mapsto s \bullet_{f^* B} (g x_i)_i) \]
  % \[
  %   s \bullet_{f^* B} (g x_i)_i
  %   = f(s) \bullet (g x_i)_i
  %   = g(f(s) \bullet (x_i)_i)
  %   = g(f(s))
  % \]
  with $ \overline f_n: T^\prime_n \to f^* T_n $ the $ T^\prime $-algebra morphism with underlying function $ f_n $. Note that $ f^* $ is fully faithful, so the function at the top of the diagram is a bijection, and so precomposition by $ \overline f_n $ is a bijection as well. Since $ f^* $ is essentially surjective, we have for all $ A : \Alg T^\prime $, some $ B : \Alg T $ and an isomorphism $ h: f^* B \xrightarrow \sim A $, which gives the following commutative diagram:
  \begin{center}
    \begin{tikzcd}
      \Alg{T^\prime}(f^* T_n, f^* B) \arrow[d, "\overline f_n \cdot -", "\sim"'] \arrow[r, "- \cdot h"', "\sim"] & \Alg{T^\prime}(f^* T_n, A) \arrow[d, "\overline f_n \cdot -"]\\
      \Alg{T^\prime}(T^\prime_n, f^* B) \arrow[r, "- \cdot h"', "\sim"] & \Alg{T^\prime}(T^\prime_n, A)
    \end{tikzcd}
  \end{center}
  so the arrow on the right is an equivalence as well. Taking $ A = T^\prime_n $, there exists some $ g: \Alg{T^\prime}(f^* T_n, T^\prime_n) $ such that $ \overline f_n \cdot g = \id{T^\prime_n} $. Also, note that
  \[ \overline f_n \cdot g \cdot \overline f_n = \overline f_n \cdot \id{f^* T_n} \]
  so taking $ A = f^* T_n $, we see that
  \[ g \cdot \overline f_n = \id{f^* T_n}, \]
  so $ f_n $, the underlying function of $ \overline f_n $, is a bijection, with inverse $ g $.
\end{proof}

\begin{remark}
  Hyland's proof of this fact is almost the same, but in the last part, he uses some category theory. Instead of explicitly constructing the inverse, he notices that the bijection
  \[ \Alg{T^\prime}(f^* T_n, A) \xrightarrow[\overline f_n \cdot -] \sim \Alg{T^\prime}(T^\prime_n, A) \]
  is in fact the image of $ \op{\overline f_n} $ under the Yoneda embedding of $ \op{\Alg{T^\prime}} $ (or of $ \overline f_n $ under the covariant Yoneda embedding of $ \Alg{T^\prime} $) into the functor category $ \Alg{T^\prime} \to \SET $:
  \[ \yo(\overline f_n): \yo(f^* T_n) \to \yo(T^\prime_n). \]
  Since the Yoneda embedding is fully faithful, this shows that $ \overline f_n $ is an isomorphism of $ T^\prime $-algebras, so in particular, it is a bijection.
\end{remark}

Note that besides the categories $ \Alg T $, we can also consider the category of `all' algebraic theory algebras together (\coqident{AlgebraicTheories.AlgebraCategoryCore}{algebra_full_cat}). That is, the category $ \int_T \Alg T $ with $ (\int_T \Alg T)_0 = \sum_{T : \AlgTh}, \Alg T $ and $ (\int_T \Alg T)((S, A), (T, B)) $ consisting of pairs $ (f, f^\prime): \AlgTh(S, T) \times \SET(A, B) $ such that for all $ t: S_n $ and $ a: A^n $,
\[ f^\prime(t \bullet a) = f(t) \bullet (f^\prime(a_i))_i. \]
We then have a functor $ P: \int \Alg T \to \AlgTh $, projecting onto the first coordinate.

\begin{lemma}[\coqident{AlgebraicTheories.AlgebraCategory}{algebra_fibration}]\label{lem:algebra-fibration}
  $ P $ is a fibration.
\end{lemma}
\begin{proof}
  Given an algebraic theory morphism $ f: \AlgTh(S, T) $ and a $ T $-algebra $ A $, Definition \ref{def:algebra-pullback} gives an $ S $-algebra $ f^* A $ with underlying set $ A $. The cartesian morphism is $ (f, \id A): (\int \Alg T)((S, f^* A), (T, A)) $.

  It is cartesian because for $ (R, B): \int \Alg T $ and $ (g, g^\prime): (\int \Alg T)((R, B), (T, A)) $ and $ h: \AlgTh(R, S) $ with $ h \cdot f = g $, the required morphism over $ h $ is given by $ g^\prime: \SET(B, A) $.
\end{proof}

\section{Presheaves}\label{sec:presheaves}

\begin{definition}[\coqident{AlgebraicTheories.Presheaves}{presheaf}]
  A \iindex{presheaf} $ P $ for an algebraic theory $ T $ is a sequence of sets $ P_n $ indexed over $ \mathbb N $, together with an action
  \[ \bullet: P_m \times T_n^m \to P_n \]
  for all $ m, n $, such that
  \begin{align*}
    t \bullet (x_{l, i})_i &= t\\
    (t \bullet f) \bullet g &= t \bullet (f_i \bullet g)_i
  \end{align*}
  for all $ t: P_l $, $ f: T_m^l $ and $ g: T_n^m $.
\end{definition}

\begin{definition}[\coqident{AlgebraicTheories.PresheafMorphisms}{presheaf_morphism}]
  For an algebraic theory $ T $, a \textit{morphism}\index{presheaf!morphism} $ f $ between $ T $-presheaves $ P $ and $ Q $ is a sequence of functions $ f_n: P_n \to Q_n $ such that
  \[ f_n(t \bullet f) = f_m(t) \bullet f \]
  for all $ t: P_m $ and $ f: T_n^m $.
\end{definition}

Together, these form the category of $ T $-presheaves \iindex{$ \Pshf T $} (\coqident{AlgebraicTheories.PresheafCategoryCore}{presheaf_cat}).

\begin{lemma}[\coqident{AlgebraicTheories.PresheafCategory}{limits_presheaf_cat}]
  The category of presheaves has all limits. The $ n $th set $ \overline{P}_n $ of a limit $ \overline{P} $ of presheaves $ P_i $ is the limit of the $ n $th sets $ P_{i, n} $ of the presheaves in the limit diagram. So just like with algebraic theories and algebras, the forgetful functor from the category of presheaves to the category of indexed sets creates limits.
\end{lemma}

\begin{lemma}[\coqident{AlgebraicTheories.AlgebraCategory}{is_univalent_algebra_cat}]
  Note that just like with algebraic theories and algebras, the category of $ T $-presheaves is univalent because its (iso)morphisms preserve $ \bullet $.
\end{lemma}

An analogue to Lemma \ref{lem:algebra-fibration} shows that, like with algebras, the total category of presheaves is fibered over the category of algebraic theories (\coqident{AlgebraicTheories.PresheafCategory}{presheaf_fibration}).

The equivalence between algebraic theories and Lawvere theories gives an equivalence between the presheaf category $ \Pshf T $ of an algebraic theory, and the presheaf category $ P \L_T = [\op{\L_T}, \SET] $ of its associated Lawvere theory (see Lemma \ref{lem:lawvere-presheaf}).

\section{\texorpdfstring{$ \lambda $-}{lambda-}Theories}\label{sec:lambda-theories}

Now we get to the core definition: $ \lambda $-theories. It is what allows us to use algebraic theories to reason about the $ \lambda $-calculus.

Let \index{$ \iota_{m, n} $}$ \iota_{m, n} : T_m \to T_{m + n} $ be the `inflation' function that sends $ f $ to $ f \bullet (x_{m + n, 1}, \dots, x_{m + n, m}) $. Note that
\[ \iota_{m, n}(f) \bullet g = f \bullet (g_i)_{i \leq m} \quad \text{and} \quad \iota_{m, n}(f \bullet g) = f \bullet (\iota_{m, n}(g_i))_i. \]

\begin{definition}[\coqident{AlgebraicTheories.LambdaTheories}{lambda_theory}]
  A \iindex{$ \lambda $-theory} is an algebraic theory $ L $, together with sequences of functions $ \lambda_n: L_{n + 1} \to L_n $ and $ \rho_n: L_n \to L_{n + 1} $, such that
  \begin{align*}
    \lambda_m(f) \bullet h &= \lambda_n(f \bullet ((\iota_{n, 1}(h_i))_i + (x_{n + 1})))\\
    \rho_n(g \bullet h) &= \rho_m(g) \bullet ((\iota_{n, 1}(h_i))_i + (x_{n + 1}))
  \end{align*}
  for all $ f: L_{m + 1} $, $ g: L_m $ and $ h: L_n^m $.
\end{definition}

\begin{definition}[\coqident{AlgebraicTheories.LambdaTheories}{has_β} \coqident{AlgebraicTheories.LambdaTheories}{has_η}]\label{def:beta-equality}
  We say that a $ \lambda $-theory $ L $ satisfies $ \beta $-equality (or that it is a $ \lambda $-theory with $ \beta $) if $ \rho_n \circ \lambda_n = \id{L_n} $ for all $ n $. We say that is satisfies $ \eta $-equality if $ \lambda_n \circ \rho_n = \id{L_{n + 1}} $ for all $ n $.
\end{definition}

\begin{remark}
  Hyland claims that `a $ \lambda $-theory is an algebraic theory $ L $ equipped with semi-closed structure'. By `semi-closed structure', he probably means the structure of a semi cartesian closed category on the Lawvere theory associated to $ L $ (Lemma \ref{lem:lawvere-clone}). Because a Lawvere theory has finite products, we even would have a weak cartesian closed category. For more information about weak cartesian closed categories, see Appendix \ref{ch:weak-cartesian-closed-categories}.

  In the appendix, we see that a $ \lambda $-theory structure with $ \beta $-equality on an algebraic theory $ L $ gives its associated Lawvere theory $ C $ a weak cartesian closed structure with the exponential object $ 1^1 $ equal to $ 1 $. Conversely, we can give $ L $ a $ \lambda $-theory structure with $ \beta $-equality from a weak cartesian closed structure on $ C $ where $ 1 $ is a reflexive object. Note that we really need $ 1 $ to be a reflexive object to make the construction work.

  However, note that a weak cartesian closed structure on $ C $ with $ 1 $ a reflexive object contains more information than a $ \lambda $-theory structure with $ \beta $-equality on $ L $: If we have a $ \lambda $-theory structure with $ \beta $-equality on $ L $, then construct from this a weak cartesian closed category structure with $ 1^1 = 1 $ on $ C $ and derive from this again a $ \lambda $-theory structure on $ L $, we get the same $ \lambda $-theory structure that we started out with. If, on the other hand, we go from a weak cartesian closed structure where $ 1 $ is a reflexive object to a $ \lambda $-theory structure with $ \beta $-equality and then to a weak cartesian closed structure again, we might end up with a different structure than the one that we started out with. This is because a weak cartesian closed structure is not necessarily unique up to isomorphism. In particular, we construct semi-exponential objects $ m^n $ which are equal to $ m $ for all $ m, n : C $, and derive their data ($ \mathrm{ev} $ and $ \mathrm{cur} $) from just the data of $ 1^1 $ in the original weak cartesian closed structure. Therefore, there are enough ways in which the resulting weak cartesian closed structure can differ from the original one.

  Note that here, we really need a choice for the exponential objects. It is not enough to just ask for the mere existence of semi-exponential objects. This is because we need the information contained in $ \mathrm{ev}: L_2 $ and $ \mathrm{cur} : L_{n + 1} \to L_n $ to define $ \lambda $ and $ \rho $.

  Lastly, if $ L $ has both $ \beta $- and $ \eta $-equality, the weak cartesian closed structure becomes a cartesian closed structure, which is unique, so in that case, giving an algebraic theory $ L $ a $ \lambda $-theory structure with $ \beta $- and $ \eta $-equality is the same as giving its associated Lawvere theory a cartesian closed category structure.
\end{remark}

\begin{definition}[\coqident{AlgebraicTheories.LambdaTheoryMorphisms}{lambda_theory_morphism}]
  A \textit{morphism}\index{$ \lambda $-theory!morphism} $ f $ between $ \lambda $-theories $ L $ and $ L^\prime $ is an algebraic theory morphism $ f $ such that
  \begin{align*}
    f_n(\lambda_n(s)) &= \lambda_n(f_{n + 1}(s))\\
    \rho_n(f_n(t)) &= f_{n + 1}(\rho_n(t))
  \end{align*}
  for all $ s: L_{n + 1} $ and $ t: L_n $.
\end{definition}

Together, these form the category of $ \lambda $-theories \iindex{$ \LamTh $} (\coqident{AlgebraicTheories.LambdaTheoryCategoryCore}{lambda_theory_cat}).

\begin{lemma}[\coqident{AlgebraicTheories.LambdaTheoryCategory}{limits_lambda_theory_cat}]
  The category of lambda theories has all limits, with the underlying algebraic theory of a limit being the limit of the underlying algebraic theories. Therefore, the forgetful functor to the category of algebraic theories creates limits.
\end{lemma}

\begin{lemma}[\coqident{AlgebraicTheories.LambdaTheoryCategory}{is_univalent_lambda_theory_cat}]
  Note that just like with algebraic theories, the category of $ \lambda $-theories is univalent because its (iso)morphisms preserve $ \rho $ and $ \lambda $.
\end{lemma}

\begin{definition}
  A $ \lambda $-theory algebra or presheaf is an algebra or presheaf for the underlying algebraic theory.
\end{definition}

\subsection{The $ \lambda $-Calculus Operations}\label{subsec:lambda-calculus-operations}
For a $ \lambda $-theory $ L $, we have variables $ x_{n, i} : L_n $ and $ \lambda $-abstraction $ f \mapsto \lambda(f) $. We will sometimes denote $ \lambda(f) $ as $ \lambda x_{n + 1}, f $ for $ f: L_{n + 1} $. Now, consider the element $ \rho(x_{1, 1}) : L_2 $.
\begin{definition}[\coqident{AlgebraicTheories.LambdaTheories}{app'}]
  Using the substitution, we have binary operations on the $ L_n $, sending $ (f, g) : L_n \times L_n $ to $ \rho(x_{1, 1}) \bullet (f, g) : L_n $. We will denote $ \rho(x_{1, 1}) \bullet (f, g) $ as $ f g $, and this gives us our application operation.
\end{definition}
This means that we can interpret all three operations (\texttt{var}, \texttt{app} and \texttt{abs}) of the $ \lambda $-calculus in $ L $.

\begin{remark}[\coqident{AlgebraicTheories.LambdaTheories}{app}]
  Note that for $ f, g : L_n $,
  \[
    \rho(f) \bullet (x_1, \dots, x_n, g)
    = \rho(x_1) \bullet (\iota_{n, 1}(f), x_{n + 1}) \bullet (x_1, \dots, x_n, g)
    = \rho(x_1) \bullet (\iota_{n, 1}(f), g),
  \]
  so we could also define the application as $ f g = \rho(f) \bullet (x_1, \dots, x_n, g) $, although that is more complicated.
\end{remark}

\begin{lemma}[\coqident{AlgebraicTheories.LambdaTheories}{beta_equality}]
  The definitions for $ \beta $- and $ \eta $-equality in Definition \ref{def:beta-equality} correspond to the usual notions.
\end{lemma}
\begin{proof}
  If $ L $ has $ \beta $-equality, we have
  \[ \lambda(f) g = \rho(\lambda(f)) \bullet (x_1, \dots, x_n, g) = f \bullet (x_1, \dots, x_n, g), \]
  so we have the usual $ \beta $-equality. In the same way $ \eta $-equality of $ L $ gives
  \[ \lambda(\iota_{n, 1}(f) x_{n + 1}) = \lambda(\rho(f)) = f. \]
\end{proof}

\begin{remark}[\coqident{AlgebraicTheories.LambdaTheories}{app_from_app'}]
  Also note that for $ f: L_n $,
  \[ \rho(f) = \rho(x_1 \bullet f) = \iota_{n, 1}(f) x_{n + 1}. \]
  Therefore, we can also think of the application as being the primary operation, from which we derive $ \rho $. In the same way, we have
  \[ \rho^m(f) = \iota_{n, m}(f) x_{n + 1} \dots x_{n + m}. \]
\end{remark}

\begin{remark}\label{rem:lambda-theory-or-algebra}
  Now, there are two ways to study $ \lambda $-calculus-like structures using the tools given here. We can study $ \lambda $-theories, which by the reasoning above have a $ \lambda $-calculus structure. Alternatively, we can try to study the $ \lambda $-calculus-like structures as algebras for some algebraic theory $ \Lambda $. However, it is not clear beforehand that this will succeed, because there is no reason why the category of $ \lambda $-calculus-like structures should be algebraic. In particular, $ \lambda $-abstraction causes problems, because it is not an algebraic operation. Of course, we can still do exactly the same as in Example \ref{ex:free-monoid-theory}: We can let $ \Lambda_n $ be the set of $ \Lambda $-terms with constants $ x_1, \dots, x_n $, which we can also regard as free variables (see Definition \ref{def:pure-lambda-calculus}), and study the category $ \Alg \Lambda $.

  Later on, we will see that these two ways of studying $ \lambda $-calculus-like structures do coincide: we will see that the category $ \LamTh $ is indeed algebraic, and moreover, that the objects of $ \Alg \Lambda $ are equivalent to $ \lambda $-theories.
\end{remark}

\section{Examples}\label{sec:algebraic-theory-examples}

There are a lot of different examples of algebraic theories and $ \lambda $-theories and their algebras. In this section, we will discuss a couple of these examples.

\subsection{The Free Algebraic Theory on a Set}
\begin{example}[\coqident{AlgebraicTheories.Examples.FreeTheory}{free_functor}]
  Let $ S $ be a set. We can construct an algebraic theory $ F(S) $ by taking $ F(S)_n = S \sqcup \{ 1, \dots, n \} $ with projections $ x_i = i $ and substitution
  \begin{align*}
    i \bullet g &= g_i & s \bullet g &= s
  \end{align*}
  for $ i : \{ 1, \dots, n \} $ and $ s : S $.

  If we have a function $ f: S \to S^\prime $, we get a morphism $ F(f): F(S) \to F(S^\prime) $ given by
  \begin{align*}
    F(f)_n(i) &= i & F(f)_n(s) &= f(s)
  \end{align*}
  for $ i : \{ 1, \dots, n \} $ and $ s : S $.

  Also, $ F $ obviously respects the identity and substitution morphisms, so it is a functor.
\end{example}

Note that we have a forgetful functor $ (\cdot)_0 $ that sends a morphism of algebraic theories $ g: T \to T^\prime $ to the function $ g_0: T_0 \to T^\prime_0 $.

\begin{lemma}[\coqident{AlgebraicTheories.Examples.FreeTheory}{free_functor_is_free}]
  The algebraic theory $ F(S) $ defined above, is the free algebraic theory on the set $ S $.
\end{lemma}
\begin{proof}
  Let $ T $ be an algebraic theory. We have a bijection
  \[ \AlgTh(F(S), T) \cong \SET(S, T_0), \]
  sending $ f: \AlgTh(F(S), T) $ to $ f_0: S = S \sqcup \emptyset \to T_0 $ (this is trivially natural in $ S $ and $ T $) and $ f: \SET(S, T_0) $ to the functions $ g_n: F(S)_n \to T_n $ given by
  \begin{align*}
    g_n(i) &= x_i & g_n(s) &= f(s) \bullet ().
  \end{align*}
\end{proof}

The proofs that $ F(S) $ is an algebraic theory and that $ F(f) $ and $ g $ are algebraic theory morphisms are easy exercises in case distinction.

\begin{corollary}[\coqident{AlgebraicTheories.Examples.ProjectionsTheory}{projections_theory}]
  $ F(\emptyset) $ is the initial algebraic theory.
\end{corollary}
\begin{proof}
  For $ S = \emptyset $, the bijection of hom-sets becomes
  \[ \AlgTh(F(\emptyset), T) \cong \SET(\emptyset, T_0) \]
  and the latter has exactly one element.
\end{proof}

\begin{lemma}[\coqident{AlgebraicTheories.Examples.ProjectionsTheory}{algebra_coslice_equivalence}]
  There is an adjoint equivalence between the category $ \Alg{F(S)} $ and the coslice category $ S \downarrow \SET $.
\end{lemma}
\begin{proof}
  For the equivalence, we send a $ F(S) $-algebra $ A $ to the set $ A $ with morphism $ s \mapsto s \bullet () $. An algebra morphism $ f: A \to B $ is sent to the coslice morphism $ f: (S \to A) \to (S \to B) $. This constitutes a functor.

  Note that the category of $ F(S) $-algebras is univalent.

  Also, the functor is fully faithful, since one can show that for $ F(S) $-algebras, the coslice morphism $ \varphi: (f: S \to A) \to (f^\prime: S \to B) $ also has the structure of an algebra morphism $ \varphi: A \to B $.

  Lastly, the functor is essentially surjective, since we can lift an object $ f: S \to X $ to a $ F(S) $-algebra $ X $, with action
  \[ i \bullet x = x_i \quad \text{and} \quad s \bullet x = f(s). \]

  Therefore, the functor $ \Alg{F(S)} \to (S \downarrow \SET) $ is an adjoint equivalence.

  The proofs of these facts work by simple case distinction, and by using the properties of the coslice and algebra morphisms.
\end{proof}

\begin{remark}
  $ F(\emptyset) $ is, in some sense, the smallest nontrivial algebraic theory. Then $ F(S) $ is the smallest nontrivial algebraic theory that has the elements of $ S $ as constants.
\end{remark}

\begin{remark}\label{rem:free-theory-algebra-set}
  Note that the category of $ F(\emptyset) $-algebras is equivalent to the coslice-category $ (\emptyset \downarrow \SET) $, which, since $ \emptyset $ is the initial set, is just equivalent to $ \SET $. Therefore, $ \SET $ is algebraic.
\end{remark}

\subsection{The Free \texorpdfstring{$ \lambda $}{lambda}-Theory on a Set}

In this subsection, we will use the $ \lambda $-calculus operations defined in Subsection \ref{subsec:lambda-calculus-operations}.

Like with the free algebraic theory, we will construct the free $ \lambda $-theory as the `pure', inductive $ \lambda $-calculus, with some additional constants.

Let $ S $ be a set. Consider the sequence of inductive types $ X_n $ with the following constructors:
\begin{align*}
  \mathtt{Var}_n &: \{ 1, \dots, n \} \to X_n;\\
  \mathtt{App}_n &: X_n \to X_n \to X_n;\\
  \mathtt{Abs}_n &: X_{n + 1} \to X_n;\\
  \mathtt{Con}_n &: S \to X_n.\\
\end{align*}

Define a substitution operator $ \bullet: X_m \times X_n^m \to X_n $ by induction on the first argument:
\begin{align*}
  \mathtt{Var}_m(i) \bullet g &= g_i;\\
  \mathtt{App}_m(a, b) \bullet g &= \mathtt{App}_n(a \bullet g, b \bullet g);\\
  \mathtt{Abs}_m(a) \bullet g &= \mathtt{Abs}_n(a \bullet ((g_i \bullet (x_{n + 1, j})_j)_i + (x_{n + 1})));\\
  \mathtt{Con}_m(s) \bullet g &= \mathtt{Con}_n(s).
\end{align*}

And then quotient $ X $ by the relation generated by
\[ \mathtt{App}_m(\mathtt{Abs}_m(f), g) \sim f \bullet ((x_{n, i})_i + (g)) \]
for all $ f: X_{n + 1} $ and $ g: X_n $. This gives a sequence of sets $ (\Lambda(S)_n)_n $.

\begin{example}\label{ex:free-lambda-theory}
  We can give $ \Lambda(S) $ an algebraic theory structure with variables $ x_{m, i} = \mathtt{Var}_m(i) $ and the substitution operator $ \bullet $ defined above. We can give $ \Lambda(S) $ a $ \lambda $-theory structure with $ \beta $-equality by taking
  \[ \lambda_n(f) = \mathtt{Abs}_n(f) \quad \text{and} \quad \rho_n(f) = \mathtt{App}_{n + 1}(f \bullet (\mathtt{Var}_{n + 1}(i))_i, \mathtt{Var}_{n + 1}(n + 1)). \]

  Now, given a function $ S \to S^\prime $, we define a morphism $ \LamTh(\Lambda(S), \Lambda(S^\prime)) $ by induction, sending $ \mathtt{Var}(i) $, $ \mathtt{App}(a, b) $ and $ \mathtt{Abs}(a) $ in $ \Lambda(S) $ to their corresponding elements in $ \Lambda(S^\prime) $ and sending $ \mathtt{Con}(s) $ to $ \mathtt{Con}(f(s)) $.
\end{example}

Note that, like with the previous example, we have a forgetful functor $ (\dot)_0: \LamTh \to \SET $.

\begin{lemma}
  $ \Lambda(S) $ is the free $ \lambda $-theory on $ S $.
\end{lemma}
\begin{proof}
  Let $ L $ be a $ \lambda $-theory. We have a bijection
  \[ \LamTh(\Lambda(S), L) \cong \SET(S, L_0), \]
  sending $ f: \LamTh(\Lambda(S), L) $ to $ f_0 \vert_S: S \to L_0 $ (again, trivially natural in $ S $ and $ L $) and conversely, $ g: \SET(S, L_0) $ to the inductively defined $ f: \LamTh(\Lambda(S), L) $ given by
  \begin{align*}
    f(\mathtt{Var}(i)) &= x_i;\\
    f(\mathtt{App}(a, b)) &= f(a) f(b);\\
    f(\mathtt{Abs}(a)) &= \lambda x_{n + 1}, f(a);\\
    f(\mathtt{Con}(s)) &= g(s) \bullet ().
  \end{align*}
\end{proof}

\begin{remark}
  One can also consider this lemma a proof that we can `interpret' the $ \lambda $-calculus with some constants inside any $ \lambda $-theory $ L $ if we give an interpretation of the constants as terms in $ L_0 $.
\end{remark}

The proofs that $ \Lambda(S) $ is indeed a $ \lambda $-theory and that $ \Lambda(f) $ and $ g $ are $ \lambda $-theory morphisms, mainly work by definition of $ \bullet $, $ \lambda $ and $ \rho $, by induction on the terms of $ \Lambda(S) $ and by invoking the properties of the $ \lambda $-theory $ L $.

\begin{definition}[\coqident{AlgebraicTheories.Examples.LambdaCalculus}{lambda_calculus_lambda_theory}]\label{def:pure-lambda-calculus}
  We define the `pure' $ \lambda $-calculus $ \Lambda $ to be $ \Lambda(\emptyset) $.
\end{definition}

\begin{corollary}
  $ \Lambda $ is the initial $ \lambda $-theory.
\end{corollary}

\subsubsection{About $ \Lambda $-Algebra Morphisms}

\begin{lemma}\label{lem:make-is-lambda-algebra-morphism}
  Let $ A $ and $ B $ be $ \Lambda $-algebras and let $ f: \SET(A, B) $ be a function that preserves the application and the $ \Lambda $-definable constants:
  \[ f((x_1 x_2) \bullet (a, b)) = (x_1 x_2) \bullet (f(a), f(b)) \quad \text{and} \quad f(s \bullet ()) = s \bullet () \]
  for all $ a, b: A $ and $ s: \Lambda_0 $. Then $ f $ is a $ \Lambda $-algebra morphism.
\end{lemma}
\begin{proof}
  Note that for $ s: \Lambda_{n + 1} $ and $ a: A^{n + 1} $,
  \[ (x_1 x_2) \bullet (\lambda(s) \bullet (a_i)_i, a_{n + 1}) = s \bullet a. \]
  By induction, we can express $ s \bullet a $ using a combination of $ (x_1 x_2) \bullet (\cdot, \cdot) $ and $ \lambda^n(s) $:
  \begin{align*}
    f(s \bullet a) &= f((x_1 x_2) \bullet (\dots ((x_1 x_2) \bullet (\lambda^n(s) \bullet (), a_1), \dots), a_n))\\
    &= (x_1 x_2) \bullet (\dots ((x_1 x_2) \bullet (f(\lambda^n(s) \bullet ()), f(a_1)), \dots), f(a_n))\\
    &= s \bullet (f(a_i))_i,
  \end{align*}
  so $ f $ is a $ \Lambda $-algebra morphism.
\end{proof}

\subsection{The Free Object Algebraic Theory}

\begin{example}[\coqident{AlgebraicTheories.Examples.FreeObjectTheory}{free_object_theory}, \coqident{AlgebraicTheories.Examples.FreeObjectTheory}{free_object_algebra_functor}]
  Take a category $ \C $, with a forgetful functor $ G: \C \to \SET $ and a free functor $ F: \SET \to \C $. Let $ \eta: \id \SET \Rightarrow F \bullet G $ be the unit of the adjunction and let $ \varphi: \C(F(X), Y) \cong \SET(X, G(Y)) $ be the natural bijection of homsets.

  We define an algebraic theory $ T $ with $ T_n = G(F(\{ 1, \dots, n \})) $, projections $ x_{n, i} = \eta_{\{1, \dots, n\}}(i) $. For the substitution, note that we can view $ t: T_n^m $ as a function $ t: \{ 1, \dots, m \} \to G(F(\{ 1, \dots, n \})) $. We then take
  \[ s \bullet t = G(\varphi^{-1}(t))(s). \]

  Now, given an object $ X: \C $, we can give $ G(X) $ a $ T $-algebra structure, with action
  \[ s \bullet t = G(\varphi^{-1}(t))(s). \]
  Also, for a morphism $ f: \C(X, Y) $, we get a $ T $-algebra morphism $ G(f): G(X) \to G(Y) $. Therefore, we can view $ G $ as a functor $ G: \C \to \Alg T $.
\end{example}

The proofs that $ T $ is an algebraic theory, that $ G(X) $ is an algebra and that $ G(f) $ is an algebra morphism mainly rely on the fact that $ \varphi $ is natural.

So we have a functor from $ \C $ to the category of $ T $-algebras. One can wonder whether there also is a functor the other way, or whether $ G: \C \to \Alg T $ is even an equivalence. If the latter is true, $ \C $ is trivially an algebraic category, but the question for which algebraic categories $ G $ is an equivalence is harder to answer.

Of course, for many common categories in algebra, where an object of $ \C $ is a set with some operations between its elements, one can carefully choose some elements of $ T_0 $, $ T_1 $, $ T_2 $ etc., which act on an algebra like the specified operations, which turns $ G $ into an equivalence.

\begin{example}[\coqident{AlgebraicTheories.Examples.FreeMonoidTheory}{monoid_algebra_equivalence}]\label{ex:free-monoid-theory}
  For $ \C $ the category of monoids, $ G: \C \to \Alg T $ is an adjoint equivalence.

  Note that $ T_n $ is the free monoid on $ n $ elements. Its elements can be viewed as strings with the characters $ x_1, \dots, x_n $ (for example, $ x_1 x_5 x_3 x_{18} \dots x_7 $), with the $ x_i $ the generators of the monoid, acting as the projections of the algebraic theory.

  Let $ A $ be a $ T $-algebra. We can give $ A $ a monoid structure by taking, for $ a, b: A $,
  \[ a b = (x_1 x_2) \bullet (a, b) \]
  and unit element
  \[ 1 = () \bullet (). \]
  Then the laws like associativity follow from those laws on the monoid and from the fact that the action on the algebra commutes with the substitution:
  \[ a (b c) = (x_1 (x_2 x_3)) \bullet (a, b, c) = ((x_1 x_2) x_3) \bullet (a, b, c) = (a b) c. \]
  Note that if we take a monoid, turn it into a $ T $-algebra and then into a monoid again, we still have the same underlying set, and it turns out that the monoid operation and unit element are equal to the original monoid operation and unit element. Therefore, $ G $ is essentially surjective. It is also fully faithful, since any $ T $-algebra morphism respects the action of $ T $, which makes it into a monoid morphism. Therefore, $ G $ is an adjoint equivalence.
\end{example}

\begin{remark}
  In the same way, one can characterize groups, rings and $ R $-algebras (for $ R $ a ring) as algebras of some algebraic theory. On the other hand, one can not use this method to describe fields as algebras for some theory $ T $, because one would need to describe the inverse $ z \mapsto z^{-1} $ operation as $ t \bullet (z) $ for some $ t: T_1 $, with $ z z^{-1} = 1 $, but since the elements of the algebraic theory act on all (combinations of) elements of the algebra, one would be able to take the inverse $ 0^{-1} = t \bullet (0) $ with $ 0 0^{-1} = 1 $, which would make no sense.
\end{remark}

\begin{remark}
  Another counterexample is the category $ \mathbf{Top} $ of topological spaces. We have a forgetful functor $ G: \mathbf{Top} \to \SET $ that just forgets the topology. On the other hand, we have a free functor $ F: \SET \to \mathbf{Top} $ which endows a set with the discrete topology. The construction above yields the initial algebraic theory $ T_n = \{ 1, \dots, n \} $, with an algebra action on every topological space $ i \bullet (a_1, \dots, a_n) = a_i $. Now, note that we can endow the set $ \{ \top, \bot \} $ with four different, nonisomorphic topologies, which all yield the same $ T $-algebra. In other words: the $ T $-algebra structure does not preserve the topological information. Therefore, the functor $ G: \mathbf{Top} \to \Alg T $ is not an equivalence.
\end{remark}

\subsection{The Terminal Theory}
\begin{example}[\coqident{AlgebraicTheories.Examples.OnePointTheory}{one_point_theory}]
  We can create the trivial algebraic theory $ T $ by taking $ T_n = \{ \star \} $, with projections $ x_i = \star $ and substitution $ \star \bullet \star = \star $. Taking $ \lambda(\star) = \star $ and $ \rho(\star) = \star $, we give it a $ \lambda $-theory structure (with $ \beta $ and $ \eta $-equality). Checking that this is indeed an algebraic theory and even a $ \lambda $-theory is trivial.

  Now, given any other algebraic theory $ S $, there exists a unique function $ S_n \to T_n $ for every $ n $, sending everything to $ \star $. These functions actually constitute an algebraic theory morphism $ S \to T $. If $ S $ is a $ \lambda $-theory, the algebraic theory morphism is actually a $ \lambda $-theory morphism. Again, checking this is trivial.

  Therefore, $ T $ is the terminal algebraic theory and $ \lambda $-theory.
\end{example}

\begin{lemma}[\coqident{AlgebraicTheories.Examples.OnePointTheory}{one_point_theory_algebra_is_trivial}]
  $ \{ \star \} $ is the only algebra of the terminal theory.
\end{lemma}
\begin{proof}
  Let $ A $ be a $ T $-algebra. First of all, we have an element $ \star_A = \star_T \bullet_{0} () $. Secondly, for all elements $ a: A $, we have
  \[ a = x_1 \bullet (a, \star) = \star \bullet (a, \star) = x_2 \bullet (a, \star) = \star. \]
  Therefore, the set of $ A $ is $ \{ \star \} $, which can have only one $ T $-action:
  \[ \star \bullet (\star, \dots, \star) = \star. \]
\end{proof}

\subsection{The Endomorphism Theory}

\begin{definition}[\coqident{AlgebraicTheories.Examples.EndomorphismTheory}{endomorphism_algebraic_theory}]\label{def:endomorphism-theory}
  Suppose that we have a category $ \C $ and an object $ X: \C $, such that all powers $ X^n $ of $ X $ are also in $ \C $.
  The \iindex{endomorphism theory} $ E(X) $ of $ X $ is the algebraic theory given by $ E(X)_n = \C(X^n, X) $ with projections as variables $ x_{n, i}: X^n \to X $ and a substitution that sends $ f: X^m \to X $ and $ g_1, \dots, g_m: X^n \to X $ to $ \langle g_i \rangle_i \cdot f: X^n \to X $.
\end{definition}

\begin{definition}[\coqident{AlgebraicTheories.Examples.EndomorphismTheory}{endomorphism_lambda_theory}]
  Now, suppose that the exponential object $ X^X $ exists, and that we have morphisms back and forth $ \mathrm{abs}: X^X \to X $ and $ \mathrm{app}: X \to X^X $. Let $ \varphi_Y $ be the isomorphism $ \C(X \times Y, X) \xrightarrow{\sim} \C(Y, X^X) $ for $ Y: \C $.
  We can give $ E(X) $ a $ \lambda $-theory structure by setting, for $ f: E(X)_{n + 1} $ and $ g: E(X)_n $,
  \[ \lambda(f) = \varphi_{X^n}(f) \cdot \mathrm{abs} \qquad \rho(g) = \varphi_{X^n}^{-1}(g \cdot \mathrm{app}). \]
\end{definition}

\begin{remark}[\coqident{AlgebraicTheories.Examples.EndomorphismTheory}{endomorphism_theory_has_β} \coqident{AlgebraicTheories.Examples.EndomorphismTheory}{endomorphism_theory_has_eta}]
  From the definition of $ \lambda $ and $ \rho $, it follows immediately that $ E(X) $ has $ \beta $-equality if $ \mathrm{abs} \cdot \mathrm{app} = \id{X^X} $.
  In the same way, if $ \mathrm{app} \cdot \mathrm{abs} = \id X $, then $ E(X) $ has $ \eta $-equality.
\end{remark}

The proofs that $ E(X) $ is an algebraic theory and a $ \lambda $-theory, use properties of the product, and naturality of the isomorphism $ \varphi_Y $.

\subsection{The Theory Algebra}
\begin{example}[\coqident{AlgebraicTheories.Examples.TheoryAlgebra}{theory_algebra}]\label{ex:theory-algebra}
  Let $ T $ be an algebraic theory and $ n $ a natural number. We can endow the $ T_n $ with a $ T $-algebra structure, by taking the substitution operator of $ T $ as the $ T $-action. Since this commutes with the substitution operator and the projections, $ T_n $ is a $ T $-algebra.
\end{example}

\begin{lemma}[\coqident{AlgebraicTheories.Examples.TheoryAlgebra}{theory_algebra_free}]
  $ T_n $ is the free $ T $-algebra on $ n $ generators.
\end{lemma}
\begin{proof}
  In Lemma \ref{lem:lawvere-algebra}, it is shown that $ T $-algebras are equivalent to finite-product-preserving $ \SET $-valued functors on the Lawvere theory $ \mathbf L $ associated to $ T $. Now, recall from Definition \ref{def:Yoneda-embedding} for any category $ C $, we can embed $ \op C $ inside $ [C, \SET] $, the category of $ \SET $-valued functors on $ C $. This embeds $ n: \mathbf L $ as the theory algebra $ T_n $. Then the Yoneda lemma gives a bijection
  \[ \Alg T(T_n, A) \cong A^n = \SET(\{ 1, \dots, n \}, A) \]
  natural in $ n $ and $ A $. Explicitly, it sends $ f: \Alg T(T_n, A) $ to $ (f(x_i))_i $ and $ (a_i)_i : A^n $ to $ f \mapsto f \bullet a $. The natural equivalence immediately shows that $ T_n $ is the free $ T $-algebra on $ n $ elements.
\end{proof}

Using some additional machinery, we can combine this with the algebra pullback functor to get another functor:
\begin{definition}\label{def:theory-algebra-pullback-functor}
  Take a nonnegative integer $ n $. Take $ S : \AlgTh $. For every $ T : \AlgTh $, we can take the $ T $-algebra $ T_n $. Then every morphism $ f: \AlgTh(S, T) $ gives an $ S $-algebra $ f^* T_n $. In fact, this is a functor from $ (S \downarrow \AlgTh) $ to $ \Alg S $: We send a morphism $ g: (S \downarrow \AlgTh)((T, f), (T^\prime, f^\prime)) $ to
  \[ g_n: f^* T_n \to (f^\prime)^* T^\prime_n. \]
  This is an algebra morphism because it commutes with $ f $, $ f^\prime $ and the substitution of $ T $ and $ T^\prime $: For $ s: S_m $ and $ t: (f^* T_n)^m $, we have
  \[
      g_n(s \bullet_{f^* T_n} t)
    = g_m(f_m(s)) \bullet_{T^\prime} (g_n(t_i))_i
    = s \bullet_{(f^\prime)^* T^\prime_n} (g_n(t_i))_i.
  \]
  The functor obviously preserves the identity morphisms and composition of morphisms, so it is indeed a functor.
\end{definition}

\subsection{The Initial Presheaf}
\begin{example}
  Let $ T $ be an algebraic theory. We can construct a $ T $-presheaf $ P $, with $ P_n = \emptyset $. Then $ \bullet : P_m \times T_n^m \to P_m $ is trivial, and the presheaf laws hold trivially.
\end{example}

\begin{lemma}
  This is indeed the initial presheaf.
\end{lemma}
\begin{proof}
  Let $ Q $ be a $ T $-presheaf. For all $ n $, since $ P_n $ is empty, there is only one possible function $ P_n \to Q_n $. These functions trivially satisfy the presheaf morphism laws, so they constitute the unique presheaf morphism $ P \to Q $.
\end{proof}

\subsection{The Theory Presheaf}
\begin{example}[\coqident{AlgebraicTheories.Presheaves}{theory_presheaf}]
  Let $ T $ be an algebraic theory. We can endow $ T $ with a $ T $-presheaf structure, by taking the substitution operator of $ T $ as the action on $ T $. Since this commutes with the substitution operator and the projections, $ T $ is a $ T $-presheaf.
\end{example}

\begin{lemma}[\coqident{AlgebraicTheories.RepresentationTheorem}{presheaf_to_L}]\label{rem:presheaf-Yoneda}
  We have natural bijections
  \[ \Pshf T(T^n, Q) \cong Q_n \]
  for $ Q : \Pshf T $.
\end{lemma}
\begin{proof}
  Lemma \ref{lem:lawvere-presheaf} shows that $ T $-presheaves are equivalent to presheaves on the Lawvere theory $ \mathbf L $ associated to $ T $. Now, recall from Definition \ref{def:Yoneda-embedding} that we can embed any category inside its own category of presheaves. This embeds $ n: \mathbf L $ as the power $ T^n = (T_m^n)_m $ of the theory presheaf. Then the Yoneda lemma gives a bijection
  \[ \Pshf T(T^n, Q) \cong Q_n \]
  natural in $ n $ and $ Q $. Explicitly, it sends $ f: \Pshf T(T^n, Q) $ to $ f_n(x_1, \dots, x_n) $ and $ q: Q_n $ to $ (t_i)_i \mapsto q \bullet t $.
\end{proof}

\subsection{The `\texorpdfstring{$ n + p $}{n + p}'-Presheaf}

\begin{example}[\coqident{AlgebraicTheories.Examples.Plus1Presheaf}{plus_1_presheaf}]
  Given a $ T $-presheaf $ Q $, we can construct a presheaf $ A(Q, p) $ with $ A(Q, p)_n = Q_{n + p} $ and, for $ q: A(Q, p)_m $ and $ f: T_n^m $, action
  \[ q \bullet_{A(Q, p)} f = q \bullet_Q ((\iota_{n, p} (f_i))_i + (x_{n + i})_i). \]
\end{example}

\begin{lemma}[\coqident{AlgebraicTheories.RepresentationTheorem}{theory_presheaf_exponentiable}]\label{lem:plus-p-presheaf}
  For all $ p $ and all $ T $-presheaves $ Q $, $ A(Q, p) $ is the exponential object $ Q^{T^p} $.
\end{lemma}
\begin{proof}
  We will show that $ A(-, p) $ constitutes a right adjoint to the functor $ - \times T^p $. We will do this using universal arrows.

  For $ Q $ a $ T $-presheaf, take the arrow $ \varphi: A(Q, p) \times T^p \to Q $ given by $ \varphi(q, t) = q \bullet_Q ((x_{n, i})_i + t) $ for $ q: A(Q, p)_n = Q_{n + p} $ and $ t: T^p_n $.

  Now, given a $ T $-presheaf $ Q^\prime $ and a morphism $ \psi: Q^\prime \times T^p \to Q $. Define $ \widetilde \psi: Q^\prime_n \to A(Q, p)_n $ by $ \widetilde \psi(q) = \psi(\iota_{n, p}(q), (x_{n + i})_i) $.

  Then $ \psi $ factors as $ (\widetilde \psi \times \id{T^p}) \cdot \varphi $. Also, some equational reasoning shows that $ \widetilde \psi $ is unique, which proves that $ \varphi $ indeed is a universal arrow.
\end{proof}
