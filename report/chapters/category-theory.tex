\chapter{Category Theoretic Preliminaries}

I will assume a familiarity with the category-theoretical concepts presented in \cite{CT4P}. These include categories, functors, isomorphisms, natural transformations, adjunctions, equivalences and limits.

\section{Notation}
For an object $ c $ in a category $ C $, I will write $ c: C $.

For a morphism $ f $ between objects $ c $ and $ c^\prime $ in a category $ C $, I will write $ f: C(c, c^\prime) $ or $ f: c \to c^\prime $.

For composition of morphisms $ f: C(c, d) $ and $ g: C(d, e) $, I will write $ f \cdot g $.

For composition of functors $ F: A \to B $ and $ G: B \to C $, I will write $ F \bullet G $.

\section{Adjunctions}
An adjoint equivalence of categories has multiple definitions. The one we will use here is the following:

\tikzset{%
    symbol/.style={%
        draw=none,
        every to/.append style={%
            edge node={node [sloped, allow upside down, auto=false]{$#1$}}}
    }
}

\begin{definition}
  An adjoint equivalence between categories $ C $ and $ D $ is a pair of adjoint functors
  \begin{center}
    \begin{tikzcd}
      D \arrow[r, bend right, "R"'{name=R}] & C \arrow[l, bend right, "L"'{name=L}]
      \ar[from=L, to=R, symbol=\dashv]
    \end{tikzcd}
  \end{center}
  such that the unit $ \eta: \id{C} \Rightarrow L \bullet R $ and counit $ \epsilon: R \bullet L \Rightarrow \id{D} $ are isomorphisms of functors.
\end{definition}


\section{Kan Extensions}
One of the most general and abstract concepts in category theory is the concept of \textit{Kan extensions}. In \cite{MacLane}, Section X.7, MacLane notes that
\begin{quote}
  The notion of Kan extensions subsumes all the other fundamental concepts of category theory.
\end{quote}
In this thesis, we will use left Kan extension a handful of times. It comes in handy when we want to extend a functor along another functor in the following way:

Let $ A $, $ B $ and $ C $ be categories and let $ F : A \to B $ be a functor.
\begin{definition}
  Precomposition gives a functor between functor categories $ F_* : [B, C] \to [A, C] $. If $ F_* $ has a left adjoint, we will denote call this adjoint functor the \textit{left Kan extension} along $ F $ and denote it $ \mathrm{Lan}_F : [A, C] \to [B, C] $.

  \begin{center}
    \begin{tikzcd}[column sep=.5cm]
      A \arrow[rr, "F"] \arrow[rd, dashed, "F_* G"'] & & B \arrow[ld, "G"]\\
      & C
    \end{tikzcd} \hspace{2cm} \begin{tikzcd}[column sep=.5cm]
      A \arrow[rr, "F"] \arrow[rd, "G"'] & & B \arrow[ld, dashed, "\Lan F G"]\\
      & C
    \end{tikzcd}
  \end{center}

  Analogously, when $ F_* $ has a right adjoint, one calls this the \textit{right Kan extension} along $ F $ and denote it $ \mathrm{Ran}_F: [A, C] \to [B, C] $.
\end{definition}

If a category has limits (resp. colimits), we can construct the right (resp. left) Kan extension in a `pointwise' fashion (see Theorem X.3.1 in \cite{MacLane} or Theorem 2.3.3 in \cite{Kashiwara}). Below, I will outline the parts of the construction that we will need explicitly in this thesis.
\begin{lemma}
  If $ C $ has colimits, $ \Lan F {} $ exists.
\end{lemma}
\begin{proof}
  First of all, for objects $ b: B $, we take
  \[ \Lan F G(b) := \text{colim} \left( (F \downarrow b) \to A \xrightarrow G C \right). \]

  Here, $ (F \downarrow b) $ denotes the comma category with as objects the morphisms $ B(F(a), b) $ for all $ a: A $, and as morphisms from $ f: B(F(a), b) $ to $ f^\prime: B(F(a^\prime), b) $ the morphisms $ g: A(a, a^\prime) $ that make the diagram commute:
  \begin{center}
    \begin{tikzcd}[column sep=.5cm]
      F(a) \arrow[rr, "F(g)"] \arrow[rd, "f^\prime"'] & & F(a^\prime) \arrow[ld, "f^\prime"]\\
      & b
    \end{tikzcd}
  \end{center}
  and $ (F \downarrow b) \to A $ denotes the projection functor that sends $ f: B(F(a_1), b) $ to $ a_1 $.

  Now, a morphism $ h: B(b, b^\prime) $ gives a morphism of diagrams, sending the $ F(a) $ corresponding to $ f: B(G(a), b) $ to the $ F(a) $ corresponding to $ f \cdot h: B(G(a), b^\prime) $. From this, we get a morphism $ \Lan F G(h): C(\Lan F G(b), \Lan F G(b^\prime)) $.

  The unit of the adjunction is a natural transformation $ \eta: \id{[A, C]} \Rightarrow \Lan F {} \bullet F_* $. We will define this pointwise, for $ G: [A, C] $ and $ a: A $. Our diagram contains the $ G(a) $ corresponding to $ \id{F(a)}: (F \downarrow F(a)) $ and the colimit cocone gives a morphism
  \[ \eta_G(a) : C(G(a), \Lan F G (F(a))), \]
  the latter being equal to $ (\Lan F {} \bullet F_*)(G)(a) $.

  The counit of the adjunction is a natural transformation $ \epsilon: F_* \bullet \Lan F {} \Rightarrow \id{[B, C]} $. We will also define this pointwise, for $ G: [B, C] $ and $ b: B $. The diagram for $ \Lan F (F_* G)(b) $ consists of $ G(F(a)) $ for all $ f: B(F(a), b) $. Then, by the universal property of the colimit, the morphisms $ G(f): C(G(F(a)), G(b)) $ induce a morphism
  \[ \epsilon_G(b) : C(\Lan F (F_* G)(b), G(b)). \]
\end{proof}

\begin{lemma}
  If $ F : A \to B $ is a fully faithful functor, and $ C $ is a category with colimits, $ \eta $ is a natural isomorphism.
\end{lemma}
\begin{proof}
  To show that $ \eta $ is a natural isomorphism, we have to show that $ \eta_G(a^\prime): G(a^\prime) \Rightarrow \Lan F G(F(a^\prime)) $ is an isomorphism for all $ G: [A, C] $ and $ a^\prime: A $. Since a left adjoint is unique up to natural isomorphism, we can assume that $ \Lan F G(F(a^\prime)) $ is given by
  \[ \text{colim} ((F \downarrow F(a^\prime)) \to A \xrightarrow G C). \]
  Now, the diagram for this colimit consists of $ G(a) $ for each arrow $ f: B(F(a), F(a^\prime)) $. Since $ F $ is fully faithful, we have $ f = F(\overline f) $ for some $ \overline f: A(a, a^\prime) $. If we now take the arrows $ G(\overline f): C(G(a), G(a^\prime)) $, the universal property of the colimit gives an arrow
  \[ \varphi: C(\Lan F G(F(a^\prime)), G(a^\prime)) \]
  which constitutes an inverse to $ \eta_G(a^\prime) $.
\end{proof}

\begin{remark}
  In the same way, if $ C $ has limits, $ \epsilon $ is a natural isomorphism.
\end{remark}

\begin{corollary}
  If $ C $ has limits or colimits, precomposition of functors $ [B, C] $ along a fully faithful functor is (split) essentially surjective.
\end{corollary}
\begin{proof}
  For each $ G: [A, C] $ we take $ \Lan F G: [B, C] $, and we have $ F_*(\Lan F G) \cong G $.
\end{proof}

\begin{corollary}
  If $ C $ has colimits (resp. limits), left (resp. right) Kan extension of functors $ [A, C] $ along a fully faithful functor is fully faithful.
\end{corollary}
\begin{proof}
  Since left Kan extension along $ F $ is the left adjoint to precomposition, we have
  \[ [A, C](\Lan F G, \Lan F G^\prime) \cong [B, C](G, F_*(\Lan F G^\prime)) \cong [B, C](G, G^\prime). \]
\end{proof}


\section{The Karoubi envelope}
Let $ C $ be a category. If we have a retraction-section pair
\begin{tikzcd}
  c \arrow[r, shift left, "r"] & d \arrow[l, shift left, "s"]
\end{tikzcd}
we have (by definition) $ s \cdot r = \id d $. On the other hand, $ s \cdot r: c \to c $ is an idempotent morphism. Conversely, we can wonder whether for any idempotent morphism $ a: c \to c $, we can find a retraction-section pair $ r: c \to d $ and $ s: d \to c $ such that $ a = r \cdot s $. If this is the case, we say that the idempotent $ a $ \textit{splits}. If $ a $ does not split, we can wonder whether we can find an embedding $ \iota_C : C \hookrightarrow \overline C $ such that the idempotent $ \iota_C(a): \iota_C(c) \to \iota_C(c) $ does split.

\begin{definition}
  We define the category $ \overline C $. The objects of $ \overline C $ are tuples $ (c, a) $ with $ c: C $, $ a: C(c, c) $ such that $ a \cdot a = a $. The morphisms between $ (c, a) $ and $ (d, b) $ are morphisms $ f: C(a, b) $ such that $ a \cdot f \cdot b = f $. The identity morphism on $ (c, a) $ is given by $ a $ and $ \overline C $ inherits morphism composition from $ C $.
\end{definition}
This category is called the \textit{Karoubi Envelope}, the \textit{idempotent completion}, the \textit{category of retracts}, or the \textit{Cauchy completion} of $ C $.

% \begin{definition}
%   \TODO Karoubi envelope in terms of presheaves
%   Alternatively, one can define $ \overline C $ to be the full subcategory of the presheaf category $ [\op C, \SET] $ that consists of retracts of representable presheaves. That is, the presheaves $ P: \op C $ such that there exists
% \end{definition}

% \begin{definition}
%   Abstract definition: \TODO
% \end{definition}

% \begin{lemma}
%   Equivalence of the definitions
% \end{lemma}

\begin{remark}
  Note that for a morphism $ f: \overline C((c, a), (d, b)) $,
  \[ a \cdot f = a \cdot a \cdot f \cdot b = a \cdot f \cdot b = f \]
  and in the same way, $ f \cdot b = f $.
\end{remark}

\begin{definition}
  We have an embedding $ \iota_C: C \to \overline C $, sending $ c: C $ to $ (c, \id{c}) $ and $ f: C(c, d) $ to $ f $.
\end{definition}

\begin{lemma}
  Every object $ c: \overline C $ is a retract of $ \iota_C(c_0) $ for some $ c_0: C $.
\end{lemma}
\begin{proof}
  Note that $ c = (c_0, a) $ for some $ c_0: C $ and an idempotent $ a: c \to c $. We have morphisms
  \begin{tikzcd}
    \iota_C(c) \arrow[r, shift left, "a_\rightarrow"] & (c, a) \arrow[l, shift left, "a_\leftarrow"]
  \end{tikzcd}, both given by $ a $. We have $ a_\leftarrow \cdot a_\rightarrow = a = \id{(c, a)} $, so $ (c, a) $ is a retract of $ \iota_C(c) $.
\end{proof}

\begin{lemma}
  Every idempotent splits in $ \overline C $.
\end{lemma}
\begin{proof}
  Take an idempotent $ a: C(c, c) $. We have an object $ (c, a): \overline C $. By the previous lemma, $ (c, a) $ is a retract of $ \iota_C(c) $. We have $ \iota_C(a) = a = a_\rightarrow \cdot a_\leftarrow $, so $ a $ splits in $ \overline C $.
\end{proof}

\begin{remark}
  Note that the embedding is fully faithful, since
  \[ \overline C((c, \id c), (d, \id d)) = \{ f: C(c, d) \mid \id c \cdot f \cdot \id d = f \} = C(c, d). \]
\end{remark}

\begin{remark}
  Let $ D $ be a category. Suppose that we have a retraction-section pair in $ D $, given by
  \begin{tikzcd}
    d \arrow[r, shift left, "r"] & d^\prime \arrow[l, shift left, "s"]
  \end{tikzcd}.
  Now, suppose that we have an object $ c: D $ and a morphism $ f $ with $ (r \cdot s) \cdot f = f $. Then we get a morphism $ s \cdot f: d^\prime \to c $ such that $ f $ factors as $ r \cdot (s \cdot f) $. Also, for any $ g $ with $ r \cdot g = f $, we have
  \[ g = s \cdot r \cdot g = s \cdot f. \]
  \begin{center}
    \begin{tikzcd}
      d \arrow[r, left, "r"] \arrow[rd, "f"'] & d^\prime \arrow[r, "s"] \arrow[d, "s \cdot f" description] & d \arrow[ld, "f"]\\
      & c
    \end{tikzcd}.
  \end{center}
  Therefore, $ d^\prime $ is the equalizer of \begin{tikzcd}
    d \arrow[r, shift left, "\id d"] \arrow[r, shift right, "r \cdot s"'] & d
  \end{tikzcd}. In the same way, it is also the coequalizer of this diagram.
\end{remark}

Since a functor preserves retracts, and since every object of $ \overline C $ is a retract of an object in $ C $, one can lift a functor from $ C $ (to a category with (co)equalizers) to a functor on $ \overline C $.

For convenience, the lemma below works with pointwise left Kan extension using colimits, but one could also prove this using just (co)equalizers (or right Kan extension using limits).
\begin{lemma}
  Let $ D $ be a category with colimits. We have an adjoint equivalence between $ [C, D] $ and $ [\overline C, D] $.
\end{lemma}
\begin{proof}
  We already have an adjunction $ \Lan {\iota_C} {} \dashv \iota_{C*} $. Also, since $ \iota_C $ is fully faithful, we know that $ \eta $ is a natural isomorphism. Therefore, we only have to show that $ \epsilon $ is a natural isomorphism. That is, we need to show that $ \epsilon_G(c, a): D(\Lan {\iota_C} (\iota_{C*} G) (c, a), G(c, a)) $ is an isomorphism for all $ G: [\overline C, D] $ and $ (c, a): \overline C $.

  One of the components in the diagram of $ \Lan {\iota_C} (\iota_{C*} G) (c, a) $ is the $ \iota_{C*} G(c) = G(c, \id c) $ corresponding to $ a: \iota_C(c) \to (c, a) $. This component has a morphism into our colimit
  \[ \varphi: C(G(\iota_C(c)), \Lan {\iota_C} (\iota_{C*} G) (c, a)). \]
  Note that we can view $ a $ as a morphism $ a: \overline C((c, a), \iota_C(c)) $. This gives us our inverse morphism
  \[ G(a) \cdot \varphi: C(G(c, a), \Lan {\iota_C} (\iota_{C*} G) (c, a)). \]
\end{proof}

\begin{lemma}
  The formation of the opposite category commutes with the formation of the Karoubi envelope.
\end{lemma}
\begin{proof}
  An object in $ \overline{\op C} $ is an object $ c: \op C $ (which is just an object $ c: C $), together with an idempotent morphism $ a: \op C(c, c) = C(c, c) $. This is the same as an object in $ \op{\overline C} $.

  A morphism in $ \overline{\op C}((c, a), (d, b)) $ is a morphism $ f: \op C(c, d) = C(d, c) $ such that
  \[ b \cdot_C f \cdot_C a = a \cdot_{\op C} f \cdot_{\op C} b = f. \]
  A morphism in $ \op{\overline C}((c, a), (d, b)) = \overline C((d, b), (c, a)) $ is a morphism $ f: C(d, c) $ such that $ b \cdot f \cdot a = f $.

  Now, in both categories, the identity morphism on $ (c, a) $ is given by $ a $.

  Lastly, $ \overline {\op C} $ inherits morphism composition from $ \op C $, which is the opposite of composition in $ C $. On the other hand, composition in $ \op{\overline C} $ is the opposite of composition in $ \overline C $, which inherits composition from $ C $.
\end{proof}

\begin{corollary}
  As the category $ \SET $ is cocomplete, we have an equivalence between the category of presheaves on $ C $ and the category of presheaves on $ \overline C $.
\end{corollary}

\section{Monoids as categories}
Take a monoid $ M $.
\begin{definition}
  We can construct a category $ C_M $ with $ C_{M0} = \{ \star \} $, $ C_M(\star, \star) = M $. The identity morphism on $ \star $ is the identity $ 1: M $. The composition is given by multiplication $ g \cdot_{C_M} f = f \cdot_M g $.
\end{definition}

\begin{definition}
  A \textit{right monoid action} of $ M $ on a set $ X $ is a function $ X \times M \to X $ such that for all $ x: X $, $ m, m^\prime: M $,
  \[ x 1 = x \qquad \text{and} \qquad (x m) m^\prime = x (m \cdot m^\prime). \]
\end{definition}

\begin{definition}
  A \textit{morphism} between sets $ X $ and $ Y $ with a right $ M $- action is an $ M $-equivariant function $ f: X \to Y $: a function such that $ f(xm) = f(x)m $ for all $ x: X $ and $ m: M $.
\end{definition}

\begin{lemma}
  Presheaves on $ C_M $ are equivalent to sets with a right $ M $-action.
\end{lemma}
\begin{proof}
  This correspondence sends a presheaf $ F $ to the set $ F(\star) $, and conversely, the set $ X $ to the presheaf $ F $ given by $ F(\star) := X $. The $ M $-action corresponds to the presheaf acting on morphisms as $ xm = F(m)(x) $. A morphism (natural transformation) between presheaves $ F \Rightarrow G $ corresponds to a function $ F(\star) \to G(\star) $ that is $ M $-equivariant, which is exactly a monoid action morphism.
\end{proof}

\begin{definition}
  We can view $ M $ as an object $ U_M $ in $ C_M $, with action $ m n = m \cdot_M n $ for $ m: U_M $ and $ n: M $.
\end{definition}

\begin{remark}
  Since the category of sets with an $ M $-action is equivalent to a presheaf category, it has all limits. However, we can make this concrete. The set of the product $ \prod_i X_i $ is the product of the underlying sets. The action is given pointwise by $ (x_i)_i m = (x_i m)_i $.
\end{remark}

\begin{lemma}
  The category $ C $ of sets with an $ M $-action has exponentials.
\end{lemma}
\begin{proof}
  Given sets with $ M $-action $ X $ and $ Y $. Consider the set $ C(M \times X, Y) $ with an $ M $-action given by $ \phi m^\prime(m, x) = \phi(m^\prime m, x) $.
\end{proof}

Exponentials: \TODO\\
Global elements: \TODO\\
Restriction of scalars: \TODO\\
Extension of scalars: \TODO\\
Extension of scalars preserves the monoid action: \TODO\\
Extension of scalars preserves limits: \TODO
