\chapter{Hyland's Paper}\label{ch:the-paper}

\section{Scott's Representation Theorem}

Now, Scott's representation theorem, which asks whether we can represent any $ \lambda $-theory as the endomorphism theory of some reflexive object in some cartesian closed category, can be answered using the presheaf category.
\begin{theorem}[\coqident{AlgebraicTheories.RepresentationTheorem}{representation_theorem_iso}]\label{thm:representation-theorem}
  Any $ \lambda $-theory $ L $ is isomorphic to the endomorphism $ \lambda $-theory $ E_{\Pshf L}(L) $, with $ L $ viewed as a presheaf.
\end{theorem}
\begin{proof}
  First of all, remember that $ L $ is indeed exponentiable and that $ L^L = A(L, 1) $.
  Now, since $ L $ is a $ \lambda $-theory, we have sequences of functions back and forth $ \lambda_n: A(L, 1)_n \to L_n $ and $ \rho_n: L_n \to A(L, 1)_n $. These commute with the $ L $-actions, so they constitute presheaf morphisms and $ E(L) $ is indeed a $ \lambda $-theory.

  Remark \ref{rem:presheaf-Yoneda} gives a sequence of bijections $ \varphi_n : \Pshf L(L^n, L) \cong L_n $ for all $ n $, sending $ F: \Pshf L(L^n, L) $ to $ F(x_1, \dots, x_n) $, and conversely sending $ s: L_n $ to $ ((t_1, \dots, t_n) \mapsto s \bullet (t_1, \dots, t_n)) $. It considers $ \lambda $-terms in $ n $ variables as $ n $-ary functions on the $ \lambda $-calculus. Therefore, it should come as no surprise that $ \varphi $ preserves the $ x_i $, $ \bullet $, $ \rho $ and $ \lambda $, which makes it into an isomorphism of $ \lambda $-theories and this concludes the proof.
\end{proof}
So Hyland shows that the representation theorem follows largely from the fact that the functions from $ L_n $ to itself can be represented by $ L_{n + 1} $, together with the Yoneda lemma for the Lawvere theory associated to $ L $ (Remark \ref{rem:presheaf-Yoneda}).

This proof is particularly nice, because it does not require $ \beta $- or $ \eta $-equality, but if $ L $ has $ \beta $- or $ \eta $-equality, then we can immediately see (even without the isomorphism from the theorem) that the endomorphism theory also has this property.

\begin{remark}
  Actually, in this thesis we stumbled upon another category with a reflexive object that exhibits $ L $ as its endomorphism theory, provided that $ L $ has $ \beta $-equality: In Appendix \ref{ch:weak-cartesian-closed-categories}, we see that the Lawvere theory $ C $ associated to $ L $ is a weak cartesian closed category, in which $ 1^1 = 1 $. It is then easy to see that the endomorphism theory that we obtain from this reflexive object $ 1 $ is exactly equal to $ L $.

  Note, however, that this is technically not an answer to Scott's original theorem, because the original formulation asks for a cartesian closed category with a reflexive object, whereas here we only have a reflexive object in a weak cartesian closed category. Even so, it is an answer to the core of the question, which is about whether we can represent any $ \lambda $-theory as the sets of morphisms $ C(U^n, U) $ for some $ U : C $.
\end{remark}

\section{Relations Between the Categories}

As mentioned before, we have a fully faithful embedding of $ \R $ into $ \Pshf L $.

Also, we have a functor from the Lawvere Theory $ \mathbf{L} $ (see Lemma \ref{lem:lawvere-clone}) associated to $ L $ into $ \R $, sending $ n : \mathbf L $ to $ U^n : \R $. By Scott's representation theorem, this functor can map morphisms as follows:
\[ \mathbf L(m, n) = L_m^n \cong \R(U^m, U)^n \cong \R(U^m, U^n), \]
which immediately shows that this functor is a fully faithful embedding.

Note that if we consider $ L_1 $ as a monoid, with operation $ \bullet $ and unit $ x_1 $, and if we consider this monoid as a category, we can embed this (fully faithfully) into $ \mathbf L $. This gives the following sequence of embeddings:
\begin{center}
  \begin{tikzcd}
    L_1 \arrow[r, hookrightarrow] & \mathbf L \arrow[r, hookrightarrow] & \R \arrow[r, hookrightarrow] & \Pshf L
  \end{tikzcd}
\end{center}

Note that the composition of the first two morphisms sends the object of the category $ L_1 $ to $ (\lambda x_1, x_1) : \R $, which is exactly the usual embedding of $ L_1 $ into its Karoubi envelope.

Write $ i: \op{L_1} \hookrightarrow \op{\mathbf L} $ and $ j: \op{\mathbf L} \hookrightarrow \op \R $ for the embeddings on the opposite categories. By Corollary \ref{cor:surjective-precomposition}, the first two functors in this sequence essentially yield surjective functors on the presheaf categories:
\begin{center}
  \begin{tikzcd}
    C_{L_1} \arrow[d, "\yo", hook] &
    \mathbf L \arrow[l, "\op i"'] \arrow[d, "yo", hook] &
    \mathbf R \arrow[rd, hook] \arrow[d, "\yo", hook] \arrow[l, "\op j"']\\
    P C_{L_1} &
    P \mathbf L \arrow[l, "i_*"', two heads] &
    P \R \arrow[l, "j_*"', two heads] \arrow[ll, "\sim"', bend left] &
    \Pshf L \arrow[ll, "\sim", bend left]
  \end{tikzcd}
\end{center}
The two equivalences in this diagram are due to Lemma \ref{lem:lawvere-presheaf} and Corollary \ref{cor:karoubi-presheaf}.

\begin{lemma}[\coqident{CategoryTheory.Equivalences.EquivalenceFromComp}{adjoint_equivalence_1_from_comp}]\label{lem:equivalent-presheaf-cats}
  The precomposition functors $ i_* $ and $ j_* $ are adjoint equivalences.
\end{lemma}
\begin{proof}
  We will show that $ j_* $ is an adjoint equivalence. From the `two out of three' property, it follows then that $ i_* $ is also an adjoint equivalence.

  Lemma \ref{lem:lan-precomp-iso} shows that $ \eta: \id{P \mathbf L} \Rightarrow \Lan j {} \bullet j_* $ is a natural isomorphism. To complete the proof that $ j_* $ is an adjoint equivalence, we just have to show that $ \epsilon: j_* \bullet \Lan j {} \Rightarrow \id{P \mathbf L} $ is a natural isomorphism as well.

  To this end, take $ F : P \R $. By Lemma \ref{lem:lan-precomp-iso}, we have the isomorphism
  \[ \eta^{-1}_{j_* F}: j_* (\Lan j (j_* F)) \cong j_* F. \]
  Since functors preserve isomorphisms, we have $ i_* (j_* (\Lan j (j_* F))) \cong i_* (j_* F) $. However, since $ j_* \bullet i_* $ is an equivalence and in particular fully faithful, this corresponds to an isomorphism
  \[ \Lan j (j_* F) \cong F. \]
  Now we only need to prove that its morphism is equal to $ \epsilon_F $. Equivalently, we need to prove that $ i_* (j_* \epsilon) $ is equal to the morphism $ i_* \eta_{j_* F}^{-1} $, or that $ j_* \epsilon $ equals $ \eta^{-1}_{j_* F} $.

  Take $ n : \mathbf L $. We need to show that $ \epsilon_F (j(n)) = \eta_{j_* F}^{-1}(n) $ as functions from $ (\Lan j {} (j_* F)) (j(n)) $ to $ F(j(n)) $. Note that the diagram for $ (\Lan j {} (j_* F)) (j(n)) $ consists of $ F(j(m)) $ for all $ f: \R(j(m), j(n)) $. Now, as it turns out, both $ \epsilon_F (j(n)) $ and $ \eta_{j_* F}^{-1}(n) $ are defined as the colimit arrow of $ F(f) : \SET(F(j(m)), F(j(n))) $ for all $ f: \R(j(m), j(n)) $, which concludes the proof.
\end{proof}

\begin{lemma}
  The embeddings of $ \R $ into $ \Pshf L $ and $ P \R $ commute with the equivalence between these categories.
\end{lemma}
\begin{proof}
  Note:
  \[ (\yo \bullet j_*)(A)(n) = (j \bullet (\yo(A)))(n) = \yo(A)(j(n)) = \R(U^n, A) \]
  \[ (\iota \bullet \sim)(A)(n) = \{ a : L_n \mid \iota_{0, n}(A) a = a \} \]

  By Scott's representation theorem, we have $ \varphi_n: \R(U^n, U) \xrightarrow \sim L_n, $ given by
  \[ \varphi_n(f) = \iota_{0, n}(f) (x_i)_i. \]
  Restricting this equivalence to the morphisms to $ A $ yields
  \[ \R(U^n, A) \cong \{ a : L_n \mid A a = a \}. \]
  Of course, this is natural in $ A $, since for $ g: \R(A, B) $, postcomposing elements of $ \R(U^n, A) $ by $ g $ is equivalent to applying $ g $ to the elements of $ \{ a : L_n \mid A a = a \} $.

  Lastly, for $ f : L_m^n $, the presheaf actions
  \[ (\yo \bullet j_*)(A)(f) : \R(U^n, A) \to \R(U^m, A) \]
  and
  \[ (\iota \bullet \sim)(A)(f) : \{ a : L_n \mid \iota_{0, n}(A) a = a \} \to \{ a : L_m \mid \iota_{0, n}(A) a = a \} \]
  are in fact given by the substitution operations $ \bullet $ in $ E(U) $ and $ L $. Since Scott's representation theorem shows that $ E(U) $ is isomorphic to $ L $ as a $ \lambda $-theory, these substitutions are compatible with the $ \varphi_n $, which shows naturality in $ n $.
\end{proof}

\section{Relative Cartesian Closedness of the Category of Retracts}\label{sec:relatively-cartesian-closed}

Recall that in the last chapter, we saw that Paul Taylor shows that the category of retracts $ \R $, studied by Scott, is not only cartesian closed, but also `relatively cartesian closed'. To make his proof work in univalent foundations, we need the axiom of choice. The category in question is the Karoubi envelope of the category $ C_{L_0} $ associated to the monoid $ (L_0, \circ) $.

Now, recall from Chapter \ref{ch:category-theory}, that in univalent foundations there are three different definitions that we can take for the Karoubi envelope, denoted $ \overline C_{L_0} $, $ \tilde C_{L_0} $ and $ \hat C_{L_0} $. There is three of them because in classical category theory there are two definitions that are equivalent, and because for one of the definitions we have to choose whether we interpret the `existence' of a retraction as additional structure (the retraction is given explicitly) or as a property (where we demand `mere existence'). This gives the following diagram (Corollary \ref{cor:karoubi-candidates}):
\begin{center}
  \begin{tikzcd}
    C \arrow[r, hook, "\iota_C"] & \overline C \arrow[r, "\sim"] & \tilde C \arrow[r, hook, two heads] & \hat C \arrow[r, phantom, "\subseteq"] & PC
  \end{tikzcd}
\end{center}
where $ \overline C_{L_0} $ and $ \tilde C_{L_0} $ are equivalent to each other, but usually not to $ \hat C_{L_0} $. We saw that $ \hat C_{L_0} $ is the Rezk completion of $ \overline C_{L_0} $ and $ \tilde C_{L_0} $.

This is a fine example of a situation where notions that are equivalent in classical mathematics actually diverge in univalent foundations. We might say that this is annoying, because we have to be more careful which definition we pick. On the other hand, this gives `more detail' in some sense: it is interesting to study which proofs work in which context, and this tells us something about the nature of the proofs.

The proofs of Scott and Taylor are about $ \overline C_{L_0} $, because they work explicitly with idempotents. The question whether it is possible to lift the proofs to $ \tilde C_{L_0} $ or $ \hat C_{L_0} $, is left for future research. On the other hand, as we will see, Hyland works with presheaves and in this way, he shows that $ \hat C_{L_0} $ is relatively cartesian closed.

Recall that in this thesis, we use the notation $ \Delta_X $ for the functor $ C \to (C \downarrow X) $, sending $ Y $ to $ p_1 : X \times Y \to X $. Also, we use the notation $ X \triangleleft Y $ to denote the type of retraction-section pairs $ r: Y \to X $ and $ s: X \to Y $. We will sometimes not name $ (r, s) : X \triangleleft Y $ explicitly, but just mention that we have $ X \triangleleft Y $, meaning that we have such $ r $ and $ s $.

Now, officially, $ \hat C_{L_0} $ is the full subcategory of $ P C_{L_0} $, consisting of all objects $ X : P C_{L_0} $ such that there merely exists $ X \triangleleft \yo(\star) $. However, recall from the previous section that $ P C_{L_0} \cong P C_{L_1} \cong \Pshf L $. Under this equivalence, $ \yo(\star) $ is embedded as the theory presheaf $ L $, and we will work in the full subcategory $ \hat \R \subseteq \Pshf L $ of the objects $ X : \Pshf L $ such that there merely exists $ X \triangleleft L $. Of course, then $ \hat \R $ is equivalent to $ \hat C_{L_0} $.

\begin{remark}
  There are a couple of tricks that we will use in this section. First of all, note that retractions can be composed. That is, given $ (r, s) : X \triangleleft Y $ and $ (r^\prime, s^\prime) : Y \triangleleft Z $, we have
  \[ (r^\prime \cdot r, s \cdot s^\prime) : X \triangleleft Z. \]
  Therefore, if we need to show that $ X $ is a retract of $ Z $, and we know that $ X $ is a retract of $ Y $, it remains to show that $ Y $ is a retract of $ Z $.

  Also, functors preserve retractions, so if we have a functor $ F : C \to D $ and we have $ (r, s) : X \triangleleft Y $, then we have
  \[ (F(r), F(s)) : F(X) \triangleleft F(Y). \]

  Lastly, if we want to show that we can do some construction on some $ X : \hat \R $, we can often borrow the construction from $ \Pshf L $ to get some object $ Y : \Pshf L $. For this part, we cannot use the $ (r, s) : X \triangleleft L $. To show that $ Y $ is indeed in $ \hat \R $, we must show that there merely exist $ (r^\prime, s^\prime) : Y \triangleleft L $. By the recursion principle of the propositional truncation, we can assume that we have a concrete $ (r, s) : X \triangleleft L $ to construct $ r^\prime $ and $ s^\prime $.
\end{remark}

Recall that Paul Taylor's display maps for $ \R $ can be characterized as the retracts of $ \Delta_X U $ (the projection $ p_1: X \times U \to X $) in $ (\R \downarrow X) $. This idea also works for $ \hat \R $, and Hyland defines $ D(Y, X) \subseteq \hat \R(Y, X) $ to consist of the retracts of $ \Delta_X L $ in $ (\hat \R \downarrow X) $. Note that, because $ \hat \R $ is a full subcategory of $ \Pshf L $, $ (\hat \R \downarrow X) $ is equivalent to $ (\Pshf L \downarrow X) $ for $ X : \hat \R $.

\begin{remark}
  Again, being a retract of $ \Delta_X L $ is usually not a mere proposition. For example, consider the ways in which $ \Delta_X L $ is a retract of itself:
  \begin{center}
    \begin{tikzcd}
      X \times L \arrow[rr, shift left, "s"] \arrow[rd, "p_1"'] & & X \times L \arrow[ll, shift left, "r"] \arrow[ld, "p_1"]\\
      & X
    \end{tikzcd}
  \end{center}
  In this particular case, the fact that $ r $ and $ s $ are morphisms in the slice category requires that $ r \cdot p_1 = p_1 $ and $ s \cdot p_1 = p_1 $, but then we can take
  \[ r = p_1 \times f \quad \text{and} \quad s = p_1 \times g  \]
  (or more generally $ \langle p_1, f^\prime \rangle $ and $ \langle p_1, g^\prime \rangle $) for any $ f $ and $ g $ that satisfy $ g \cdot f = \id L $. Two options are
  \[ f = g = \id L \quad \text{or} \quad f_n(t) = t (\lambda x_{n + 1}, x_{n + 1}), \quad g_n(t) = \lambda x_{n + 1}, \iota_{n, 1}(t), \]
  and these options are distinct if $ L $ is nontrivial.

  Therefore, if we want $ D(Y, X) $ to be a subset of $ \hat \R(Y, X) $, we need to take the propositional truncation of the existence of $ r $ and $ s $.
\end{remark}

\begin{remark}
  Recall that for all $ X : \R $, we have $ X \triangleleft U = \lambda x_1, x_1 $, so by the above, for all $ Y $ in the image of the embedding of $ \R $ into $ \Pshf L $, we have $ Y \triangleleft L $. In particular, $ Y $ is in $ \hat \R $. Actually, we already knew this, because this essentially describes the embedding of $ \R $ into its Rezk completion $ \hat \R $.

  An important example is $ U \times U : \R $, which maps to something isomorphic to $ L \times L $ (because the Yoneda embedding and any adjoint equivalence preserves limits). The retraction $ (r, s) : L \times L \triangleleft L $ is given explicitly by the (pairing and splitting) morphisms
  \[ s_n(a, b) = \lambda x_{n + 1}, x_{n + 1} a b \quad \text{and} \quad r_n(a) = (a (\lambda x_{n + 1} x_{n + 2}, x_{n + 1}), a (\lambda x_{n + 1} x_{n + 2}, x_{n + 2})). \]
  Now, for any $ X, Y : \Pshf L $ and $ f : \Pshf L(Y, X) $, if we have $ (Y, f) \triangleleft \Delta_X L $ in $ \Pshf L $, we have in particular $ Y \triangleleft X \times L $. If we also have $ X \triangleleft L $, we also have $ X \times L \triangleleft L \times L $ because $ - \times L $ is a functor. Then we have
  \[ Y \triangleleft X \times L \triangleleft L \times L \triangleleft L. \]
  In particular, for any $ X : \hat \R $, if some $ (Y, f) : (\Pshf L \downarrow X) $ is a retract of $ \Delta_X L $, we know that $ Y $ is in $ \hat \R $.
\end{remark}

% \begin{remark}
%   Taylor would write $ (\Pshf L \downarrow_D A) $ instead of $ \R(A) $, with $ D(X, A) $ the retracts $ f: X \to A $ of $ \Delta_A L $. However, note that $ D $ is not a class of display maps. For example, for $ D $ to be a class of display maps, all terminal projections $ ! : X \to T $ need to be in $ D $. Since for any category $ C $ with terminal object $ T $, we have an equivalence $ (C \downarrow T) \cong C $, having all terminal projections in $ D $ is equivalent to every object in $ \Pshf L $ being a retract of $ L $.

%   However, if we take $ X $ to be the initial (empty) presheaf, we see that there are no morphisms $ L \to X $, because the $ L_n $ are nonempty and the $ X_n $ are empty.

%   There also is a more category-theoretical argument: Suppose that every object of $ \Pshf L $ is a retract of $ L $. Via the equivalence $ \Pshf L \cong L_1 $, we see that every object of $ P C_{L_1} $ is a retract of $ \yo(\star) $. However then the embedding of $ \hat \R $ (Definition \ref{def:karoubi'}) into $ P C_{L_1} $ is an adjoint equivalence. Since $ \yo_{\R} \bullet {\op{\iota_{L_1}}}_* : \R \to \hat \R $ and $ {\op{\iota_{L_1}}}_* : P \R \to P C_{L_1} $ are weak equivalences, (Lemma \ref{lem:retracts-rezk}, Corollary \ref{cor:karoubi-presheaf}), $ \yo_\R : \R \to P \R $ is a weak equivalence as well, but the Yoneda embedding is never essentially surjective. For any category $ C $, the constant empty presheaf $ E: c \mapsto \emptyset $ is not representable, since for all $ c : C $, $ \id c = \yo(c)(c) $, so $ \yo(c) $ is not isomorphic to $ E $.
% \end{remark}

Note that $ D $ is indeed a class of display maps:
\begin{enumerate}
  \item Take $ f : D(Y, X) $ and $ g: \hat \R(Z, X) $. We can borrow the pullback from $ \Pshf L $ to get $ g^*(Y, f) : (\Pshf L \downarrow Z) $. We now must show that there merely exists $ g^* (Y, f) \triangleleft \Delta_Z L $ and in this part, we can assume that the mere existences of retractions are actually given by concrete retraction-section pairs.

    Now, note that taking pullbacks gives a functor $ g^* : (\Pshf L \downarrow X) \to (\Pshf L \downarrow Z) $. Now, $ (Y, f) \triangleleft \Delta_X L $, gives $ (g^*Y, g^*f) \triangleleft g^*(\Delta_X L) $:
    \begin{center}
      \begin{tikzcd}
        g^* Y
          \arrow[rd, "g^*s", shift left]
          \arrow[dd, "g^* f"]
          \arrow[rr] &&
        Y
          \arrow[rd, "s", shift left]
          \arrow[dd, "f"] & \\
        & g^* (X \times L)
          \arrow[lu, "g^*r", shift left]
          \arrow[ld, "g^* p_1"]
          \arrow[rr] & &
        X \times L
          \arrow[ld, "p_1"]
          \arrow[lu, "r", shift left] \\
        Z
          \arrow[rr, "g"] & &
        X &
      \end{tikzcd}
    \end{center}
    The isomorphism between $ g^*(\Delta_X L) $ and $ \Delta_Z L $ (Remark \ref{rem:pullback-of-projection}) shows that we have $ (g^*Y, g^*f) \triangleleft \Delta_Z L $. From this, it also follows that $ g^* Y $ is in $ \hat \R $.

    Now, $ g^*Y $ is the pullback of $ f $ and $ g $ in $ \Pshf L $, and $ \hat \R $ is a full subcategory of $ \Pshf L $, so $ g^* Y $ is also the pullback of $ f $ and $ g $ in $ \hat \R $.

  \item Take $ f: D(Z, Y) $ and $ g: D(Y, X) $. We have to show that there merely exists $ (Z, f \cdot g) \triangleleft \Delta_X L $. Because this is a proposition, we can assume that we have
  \[ (r_Z, s_Z) : (Z, f) \triangleleft \Delta_Y L \quad \text{and} \quad (r_Y, s_Y) : (Y, g) \triangleleft \Delta_X L. \]
  Then the following diagram gives $ (Z, f \cdot g) \triangleleft \Delta_X (L \times L) $:
    \begin{center}
      \begin{tikzcd}
        Z \arrow[rd, "f"'] \arrow[rr, "s_Z", shift left] & & Y \times L \arrow[ld, "p_1"] \arrow[ll, shift left, "r_Z"] \arrow[rr, shift left, "s_Y \times \id L"] && X \times L \times L \arrow[ll, shift left, "r_Y \times \id L"] \arrow[ld, "p_1"]\\
        & Y \arrow[rd, "g"'] \arrow[rr, "s_Y", shift left] & & X \times L \arrow[ld, "p_1"] \arrow[ll, shift left, "r_Y"]\\
        && X
      \end{tikzcd}
    \end{center}
    Now, as we saw earlier, $ \Delta_X $ is a functor and $ L \times L $ is a retract of $ L $. Therefore, we have $ \Delta_X (L \times L) \triangleleft \Delta_X L $ and $ f \cdot g $ is in $ D(Z, X) $.

    % \begin{align*}
    %   (r_Y \times \id L) \cdot r_Z \cdot f \cdot g
    %   &= (r_Y \times \id L) \cdot p_1 \cdot g\\
    %   &= p_1 \cdot r_Y \cdot g\\
    %   &= p_1 \cdot p_1\\
    % \end{align*}

    % \begin{align*}
    %   s_Z \cdot (s_1 \times \id L) \cdot p_1 \cdot p_1
    %   &= s_Z \cdot p_1 \cdot s_1 \cdot p_1\\
    %   &= f \cdot g\\
    % \end{align*}

  \item Note that $ \Pshf L $ has a terminal presheaf $ I_n = \{ \star \} $. Under the embedding of $ \R $ into $ \Pshf L $, this is (isomorphic to) the image of $ \lambda x_1 x_2, x_2 : \R $, and therefore, it is in $ \hat \R $. Now, given $ Y : \hat \R $, we need to show that the terminal projection $ ! $ is in $ D(Y, I) $. Note that any morphism trivially commutes with the terminal projections. Since $ Y : \hat \R $, we have $ (r, s) : Y \triangleleft L $, and since $ L \cong I \times L $, this means that the terminal projection is indeed in $ D(Y, I) $:
    \begin{center}
      \begin{tikzcd}
        Y \arrow[rd, "!"'] \arrow[r, shift left, "s"] & L \arrow[d, "!"] \arrow[l, shift left, "r"] \arrow[r, "\sim"] & I \times L \arrow[ld, "!"]\\
        & I
      \end{tikzcd}
    \end{center}
\end{enumerate}

Recall that $ \Pshf L $ is isomorphic to the presheaf category $ P \mathbf L $, so it is an elementary topos and it is locally cartesian closed (Example 5.2.5 and Theorem 5.8.4, \autocite{borceux}, Volume 3). Therefore, for a morphism $ f: \Pshf L(Y, X) $, we have adjunctions
\begin{center}
  \begin{tikzcd}
    (\Pshf L \downarrow X) \arrow[r, "f^*"' description, ""{name=B}] & (\Pshf L \downarrow Y) \arrow[l, bend right, "{\sum_f = - \cdot f}"'{name=A}] \arrow[l, bend left, "\prod_f"{name=C}]
    \arrow[from=A, to=B, symbol=\dashv]
    \arrow[from=B, to=C, symbol=\dashv]
  \end{tikzcd}
\end{center}

Now, Hyland shows the following:
\begin{theorem}\label{thm:restrict-sum-product}
  For $ f : D(Y, X) $, we can restrict $ \sum_f $ and $ \prod_f $ to functors from $ (\hat \R \downarrow_D Y) $ to $ (\hat \R \downarrow_D X) $.
\end{theorem}
\begin{proof}
  Given $ (Z, g) : (\Pshf L \downarrow Y) $, for $ \prod_F $ we only have to show that if we have $ (Z, g) \triangleleft \Delta_Y L $, then we have $ \prod_f(Z, g) \triangleleft \Delta_X L $. Note that since $ X $ is in $ \hat \R $, this also shows that $ \prod_f Z $ is in $ \hat \R $. Because functors preserve retractions, it suffices to show that we have $ \prod_f \Delta_Y L \triangleleft \Delta_X L $.

  Since $ f : D(Y, X) $, we have a retraction
  \begin{center}
    \begin{tikzcd}
      Y \arrow[rd, "f"'] \arrow[r, "s"] & X \times L \arrow[d, "p_1"] \arrow[r, "r"] & Y \arrow[ld, "f"]\\
      & X
    \end{tikzcd}
  \end{center}

  The counits of the adjunctions $ r_* \vdash \prod_r $ and $ s_* \vdash \prod_s $, give maps
  \[
    \prod_f \Delta_Y L \xrightarrow{\prod_f \eta_r}
    \prod_f \prod_r r^* \Delta_Y L \xrightarrow{\prod_f \prod_r \eta_s}
    \prod_f \prod_r \prod_s s^* r^* \Delta_Y L
  \]
  Their composite is $ \prod_f \eta_{s \cdot r} $. However, note that $ r \cdot s = \id Y $, so we have an isomorphism of functors
  \[ (s \cdot r)^* \cong \id{\Pshf L \downarrow Y} \quad \text{and} \quad \prod_{s \cdot r} \cong \id{\Pshf L \downarrow Y} \]
  and transporting $ \eta_{s \cdot r} $ along these isomorphisms, we get the identity natural transformation $ \id{\Pshf L \downarrow Y} \Rightarrow \id{\Pshf L \downarrow Y} $.

  Secondly, note that $ r \cdot f = p_1 $, so we have $ \prod_r \bullet \prod_f \cong \prod_{p_1} $.

  Lastly, by Remark \ref{rem:pullback-of-projection}, $ r^* \Delta_Y L \cong \Delta_{X \times L} L $.

  Therefore, we have the following diagram, showing that $ \prod_f \Delta_Y L $ is a retract of $ \prod_{p_1} \Delta_{X \times L} L $:
  \begin{center}
    \begin{tikzcd}
      & \prod_{p_1} \Delta_{X \times L} L\\
      \prod_f \Delta_Y L
        \arrow[r, "\prod_f \eta_r"]
        \arrow[rr, bend right, "\prod_f \eta_{s \cdot r}"]
        \arrow[rrr, bend right, "\id {\Pshf L \downarrow X}"] &
      \prod_f \prod_r r^* \Delta_Y L \arrow[r, "\prod_f \prod_r \eta_s"] \arrow[u, "\sim"] &
      \prod_f \prod_r \prod_s s^* r^* \Delta_Y L \arrow[r, "\sim"] &
      \prod_f \Delta_Y L
    \end{tikzcd}
  \end{center}
  So it suffices to show that $ \prod_{p_1} \Delta_{X \times L} L $ is a retract of $ \Delta_X L $. By Lemma \ref{lem:constant-dependent-product}, we have $ \prod_{p_1} \Delta_{X \times L} L \cong \Delta_X L^L $. By functoriality of $ \Delta_X $, it suffices to show that $ L^L $ is a retract of $ L $. But we already saw in Theorem \ref{thm:representation-theorem} that $ L^L \cong A(L, 1) $ is a retract of $ L $. This shows that $ \prod_f $ indeed restricts to a functor from $ (\hat \R \downarrow_D Y) $ to $ (\hat \R \downarrow_D X) $.

  The proof for $ \sum_f $ is very similar. $ \sum_f \Delta_Y L $ is a retract of $ \sum_{p_1} \Delta_{X \times L} L $:
  \begin{center}
    \begin{tikzcd}
      & & \sum_{p_1} \Delta_{X \times L} L \\
      \sum_f \Delta_Y L
        \arrow[r, "\sim"]
        \arrow[rrr, bend right, "\id {\Pshf L \downarrow X}"] &
      \sum_f \sum_r \sum_s s^* r^* \Delta_Y L
        \arrow[r, "\sum_f \sum_r \epsilon_s"]
        \arrow[rr, bend right, "\sum_f \epsilon_{s \cdot r}"] &
      \sum_f \sum_r r^* \Delta_Y L
        \arrow[u, "\sim"]
        \arrow[r, "\sum_f \epsilon_r"] &
      \sum_f \Delta_Y L
    \end{tikzcd}
  \end{center}
  By Lemma \ref{lem:sum-postcomposition}, the functor $ \sum_{p_1} $ is given by postcomposition, so $ \sum_{p_1} \Delta_{X \times L} L \cong \Delta_X (L \times L) $. As we saw earlier, we have $ L \triangleleft L \times L $, which completes the proof that $ \sum_f $ restricts to a functor from $ (\hat \R \downarrow_D Y) $ to $ (\hat \R \downarrow_D X) $.
\end{proof}

\begin{corollary}\label{cor:relatively-cartesian-closed}
  Since the $ (\hat \R \downarrow_D X) $ are full subcategories of the $ (\Pshf L \downarrow X) $, so we can restrict the adjunction $ f^* \dashv \prod_f $ to an adjunction $ \bar f^* \dashv \bar \prod_f $ between $ (\hat \R \downarrow_D X) $ and $ (\hat \R \downarrow_D Y) $, which shows that $ \hat \R $ is cartesian closed relative to the class $ D $ of display maps.
\end{corollary}

\begin{remark}
  It is a nice feature of Hyland's approach that in univalent foundations, the proofs that $ D $ is a class of display maps and that we can restrict $ \prod_f $ and $ \sum_f $ work without the axiom of choice.
\end{remark}

\begin{remark}\label{rem:difference-Taylor-Hyland}
  Recall that to make sure that $ D(Y, X) $ is a subset of $ \hat \R(Y, X) $, we had no choice but to take the propositional truncation of the $ (Y, f) \triangleleft \Delta_X L $. Coincidentally, for $ \hat \R $ we also took the propositional truncation of the $ X \triangleleft L $.

  In the proofs that $ D $ is a class of display maps, and that we can restrict $ \prod_f $, this worked out great. A couple of times, we first did a construction on the presheaves, ignoring the mere existence of the retractions, and then we showed mere existence of one or two retractions, for which we were allowed to assume that we actually had concrete retractions from $ L $ or $ \Delta_X L $.

  Therefore, this only works in $ \hat \R \cong \hat C_{L_0} $. Suppose that we tried to do this in $ \tilde C_{L_0} $. Note that this category is equivalent to the category with as objects $ X : \Pshf L $, together with some $ (r, s) : X \triangleleft L $. Trying to define the pullback functor would already cause problems. To define a pullback, we would need to explicitly construct some retraction $ g^* Y \triangleleft L $, for which we would need a retraction $ Z \triangleleft L $. However, we have only mere existence of this retraction, so we would only be able to show mere existence of pullbacks, like in Taylor's proof. In Taylor's case, we were able to use the axiom of choice because the objects of $ \R $ form a set. However, the objects of $ \tilde \R $ do not form a set, and so we cannot use the axiom of choice here (Lemma 3.8.5 in \autocite{hottbook} shows why the axiom of choice only works for sets).

  Since we have an adjoint equivalence between $ \tilde C_{L_0} $ and $ \overline C_{L_0} = \R $, and since any reasoning about $ \R $ using presheaves would use this equivalence, we would run into the same problems if we tried try to apply Hyland's approach to $ \R $. However, note that there we might be able to use the axiom of choice to show mere existence of a pullback functor, like in Taylor's proof.
\end{remark}

% \begin{remark}
%   Now, recall that according to Hyland, Taylor endows the category of retracts $ \R $ with a class of display maps $ D $, such that $ (\R \downarrow_D X) $ consists exactly of the retracts of $ \Delta_X U $.

%   Hyland then claims that the fact that $ \R $ is cartesian closed relative to this class of display maps follows from the theorem above. Recall that Taylor already shows relative cartesian closedness directly, which still works in univalent foundations if we assume the axiom of choice.

%   Recall that we have a weak equivalence $ \varphi : \R \xrightarrow \sim \hat \R $ (Lemma \ref{lem:retracts-rezk}) and one can imagine that we can extend this to weak equivalences $ \psi_X : (\R \downarrow_D X) \xrightarrow \sim (\hat \R \downarrow_D \varphi(X)) $. Hyland notes that for $ X : \hat \R $, $ \R(\varphi(X)) $ is equivalent to $ (\hat \R \downarrow_D \varphi(X)) $. Implicitly, for $ f: \R(X, Y) $, he wants to lift the functors $ \sum_f $, $ f^* $ and $ \prod_f $ along the equivalences $ \psi $:
%   \begin{center}
%     \begin{tikzcd}[sep=large]
%       (\R \downarrow_D X)
%         \arrow[d, "\psi_X"]
%         \arrow[r, dashed, bend left, "\sum_f"']
%         \arrow[r, dashed, bend right, "\prod_f"]
%       & (\R \downarrow_D Y)
%         \arrow[d, "\psi_Y"]
%         \arrow[l, dashed, "f^*" description]\\
%       \R(\varphi(X))
%         \arrow[r, bend left, "\sum_{\varphi(f)}"']
%         \arrow[r, bend right, "\prod_{\varphi(f)}"]
%       & \R(\varphi(Y))
%         \arrow[l, "\varphi(f)^*" description]\\
%     \end{tikzcd}
%   \end{center}
%   For this to work, we need to turn the weak equivalences $ \psi_X $ into adjoint equivalences. In particular, we know that for every object $ A : \R(\varphi(X)) $, there merely exists a preimage $ \bar A : (\R \downarrow_D X) $ such that $ \psi_X(\bar A) \cong A $, and we need to construct a functor $ \psi_X^{-1}: \R(\varphi(X)) \to (\R \downarrow_D X) $.

%   For Taylor's proof, we did a similar thing when we knew that for every object $ X : (\R \downarrow_D A) $, there existed some $ Y : \R^A $, and we needed to construct a pullback functor $ f^* : (\R \downarrow_D A) \to (\R \downarrow_D B) $. We could use the axiom of choice here because the objects of $ \R $ (and therefore also the objects of the relative slices $ (\R \downarrow_D A) $) form a set.

%   However, as mentioned in \autocite{univalent-categories} halfway through the introduction, and as explained more thoroughly in \autocite{hottbook}, Lemma 3.8.5, if $ \R(\varphi(X)) $ is not a set (and if $ L $ is nontrivial, it is never a set), then there is no axiom of choice which can turn the `for all \dots, there exists \dots' into a `there exists a function'.

%   Therefore, in univalent foundations, the relative cartesian closedness is not a corollary of Theorem \ref{thm:restrict-sum-product}.
% \end{remark}

\section{An Elementary Proof of the `Fundamental Theorem'}\label{sec:elementary-fundamental-theorem}

The final theorem that Hyland works towards in his paper constructs an equivalence between two ways to reason about the $ \lambda $-calculus using these tools from universal algebra: $ \lambda $-theories and $ \Lambda $-algebras. In this section, we will provide an elementary proof of this theorem. Then, in the next section, we will give Hyland's original proof, which uses more high-level categorical reasoning.

We will assume that $ \Lambda $ (and therefore, any $ \lambda $-theory) satisfies $ \beta $-equality.

In both cases, one part of the equivalence is very easy. Recall that the pure $ \lambda $-calculus, the $ \lambda $-theory $ \Lambda $, is the initial object of $ \LamTh $. That means that $ \LamTh $ is equivalent to $ (\Lambda \downarrow \LamTh) $. Now, using Definition \ref{def:theory-algebra-pullback-functor}, for any $ n $ we get a functor
\[ -_n : \LamTh \to \Alg \Lambda. \]
Here we are only interested in the case $ n = 0 $.

We will use Lemma \ref{lem:univalen-category-equivalence}, by showing that $ -_0 $ is a weak equivalence.

First of all, let $ A $ be an algebra for the initial $ \lambda $-theory $ \Lambda $.

The $ \Lambda $-algebra structure gives the terms of $ A $ a lot of interesting behaviour. For example, we can define `function application' and composition as
\[ a b = (x_1 x_2) \bullet (a, b) \quad \text{and} \quad a \circ b = (x_1 \circ x_2) \bullet (a, b), \]
and the same for the other constructions at the start of Section \ref{sec:retracts-category}.

\begin{remark}
  Recall that in Example \ref{ex:free-monoid-theory}, we constructed an algebraic theory $ T $ encapsulating the structure of a monoid. This allowed us to define a monoid operation on $ T $-algebras as well. We then were able to transfer associativity of the operation on the $ T_n $ to associativity of the operation on the algebras. In exactly the same way, the function composition on $ A $ is associative because composition on $ \Lambda_n $ is associative. Similarly, we can show that $ \pi_1 (a, b) = a $, that $ \pi_2 \circ \langle a, b \rangle = (\lambda x_2, x_1 x_2) \bullet b $ etc.
\end{remark}

In fact, we can repeat almost the entirety of Section \ref{sec:retracts-category} for $ A $ instead of for $ L_0 $:
\begin{definition}
  We define the `category of retracts' of $ A $ as the category $ \R_A $ given by
  \[ (\R_A)_0 = \{ X : A \mid X \circ X = X \} \quad \text{and} \quad \R_A(X, Y) = \{ f : A \mid Y \circ f \circ X = f \}. \]
\end{definition}
Just like in Section \ref{sec:retracts-category}, $ \R_A $ has `universal object' and terminal object
\[ U = (\lambda x_1, x_1) \bullet () \quad \text{and} \quad I = (\lambda x_1, c_1), \]
products
\[ A \times B = \langle A \circ \pi_1, B \circ \pi_2 \rangle \]
and exponential objects
\[ B^A = (\lambda x_3, x_1 \circ x_3 \circ x_2) \bullet (B, A) \]
with the isomorphism $ \psi: \R_A(C \times A, B) \xrightarrow \sim \R_A(C, B^A) $
given by
\[ \psi(f) = (\lambda x_2 x_3, x_1 (x_2, x_3)) \bullet f \quad \text{and} \quad \psi^{-1}(f) = (\lambda x_2, x_1 (\pi_1 x_2) (\pi_2 x_2)) \bullet f. \]

Therefore, we have a $ \lambda $-theory $ E_{\R_A}(U) $.

\begin{remark}
  Note that if $ A = L_0 $, then the construction of $ \R_A $ and $ \R $ coincide, so we have an almost trivial equivalence $ \R_A \cong \R $, and an isomorphism $ E_{\R}(U) \cong E_{\R_A}(U) $.
\end{remark}

The following lemma shows that our functor is essentially surjective:

\begin{lemma}\label{lem:elementary-essentially-surjective}
  We have a $ \Lambda $-algebra isomorphism $ \epsilon_A : E_{\R_A}(U)_0 \xrightarrow \sim A $.
\end{lemma}
\begin{proof}
  Take $ c_n = (\lambda x_{n + 1}, x_{n + 1}): \Lambda_n $. Note that
  \[ E(U)_0 = \{ f : A \mid (\lambda x_2, x_1 c_2) \bullet f = f \}. \]
  Therefore, we have a bijection given by
  \[ \epsilon(a) = (x_1 c_1) \bullet a \quad \text{and} \quad \epsilon^{-1}(a) = (\lambda x_2, x_1) \bullet a. \]
  Now, to show that this is an isomorphism of $ \Lambda $-algebras, recall that $ \bullet: \R_A(U^n, U) \times \R_A(I, U)^n \to \R_A(U) $ is given by precomposition with the product morphism and that the $ \Lambda $-algebra structure on $ E(U)_0 $ is given by the embedding of $ \Lambda $ into $ E(U)_0 $, given by $ f \mapsto {\iota_\Lambda}_n(f) \bullet_A () $ for some collection $ ({\iota_\Lambda}_n: \Lambda_n \to \Lambda_0)_n $ (from now on, we will drop the $ n $ and just write $ \iota_\Lambda $). We have for all $ f: \Lambda_n $, and all $ a : E(U)_0^n $,
  \begin{align*}
    \epsilon(f \bullet_{E(U)} a)
    &= ((\iota_\Lambda(f) \bullet_A ()) \circ \langle a_i \rangle_i)(c_n)\\
    &= (\iota_{0, n}(\iota_\Lambda(f)) (x_i c_n)_i) \bullet_A a\\
    &= (\iota_{0, n}(\iota_\Lambda(f)) (x_i)_i) \bullet_A (\epsilon(a_i))_i,
  \end{align*}
  and we want this to equal $ f \bullet_A (\epsilon(a_i))_i $. Leaving out the $ \iota_{0, n} $, all we need to do is show that for all $ f: \Lambda_n $, we have $ \iota_\Lambda(f) (x_i)_i = f $. We will do this by structural induction on $ f $:
  \begin{itemize}
    \item If $ f = x_{n, i} $, we have $ \iota_\Lambda(f) = \pi_{n, i} $, and
      \[ \iota_\Lambda(f) (x_i)_i = \pi_{n, i} (x_{n, i})_i = x_{n, i}. \]
    \item If $ f = \lambda x_{n + 1}, g $ for some $ g: \Lambda_{n + 1} $, we have
      \[ \iota_\Lambda(f) = (\lambda x_1 x_2, \iota_{0, 2}(\iota_\Lambda(g)) (x_1, x_2)), \]
      and if the induction hypothesis holds for $ g $, then
      \begin{align*}
        \iota_\Lambda(f) (x_i)_i
        &= (\lambda x_{n + 1} x_{n + 2}, \iota_\Lambda(g) (x_{n + 1}, x_{n + 2})) (x_i)_i\\
        &= \lambda x_{n + 1}, \iota_\Lambda(g) ((x_i)_i, x_{n + 1})\\
        &= \lambda x_{n + 1}, g.
      \end{align*}
    \item Recall that application in a $ \lambda $-theory is given by $ g_1 g_2 = \rho(g_1) \bullet (x_1, \dots, x_n, g_2) $. Now, if $ f = g_1 g_2 $ for $ g_1, g_2 : \Lambda_{n + 1} $, we have
      \[
        \iota_\Lambda(f)
        = (\lambda x_1, \iota_\Lambda(g_1) (\pi_1 x_1) (\pi_2 x_1)) \circ \langle \id{U^n}, \iota_\Lambda(g_2) \rangle
        = \lambda x_1, \iota_\Lambda(g_1) x_1 (\iota_\Lambda(g_2) x_1),
      \]
      and if the induction hypothesis holds for $ g_1 $ and $ g_2 $, then
      \begin{align*}
        \iota_\Lambda(f) (x_i)_i
        &= (\lambda x_{n + 1}, \iota_\Lambda(g_1) x_{n + 1} (\iota_\Lambda(g_2) x_{n + 1})) (x_i)_i\\
        &= \iota_\Lambda(g_1) (x_i)_i (\iota_\Lambda(g_2) (x_i)_i)\\
        &= g_1 g_2.
      \end{align*}
  \end{itemize}
\end{proof}

Now, take a morphism $ F: \Alg{\Lambda}(A, B) $. Recall that $ \circ $, the categories $ \mathbf R_A $ and $ \mathbf R_B $, and their products and exponential objects are given using $ f \bullet (a_2, \dots, a_n) $ for some $ f: \Lambda_n $ and $ a_1, \dots, a_n : A $. Since we have $ F(f \bullet (a_i)_i) = f \bullet (F(a_i)) $, $ F $ gives a functor $ F: \R_A \to \R_B $, such that
\[ F(I) = I, F(U) = U, F(A \times B) = F(A) \times F(B) \quad \text{and} \quad F(A^B) = F(A)^{F(B)}, \]
and the same for the product projections and the the natural isomorphisms $ \R_A(C, B^A) \cong \R_A(C \times A, B) $. In particular, we have for all $ f: \R_A(U^n, U) $,
\[ F(f) : \R_B(F(U^n), F(U)) = \R_B(U^n, U). \]
Therefore, $ F $ gives a $ \Lambda $-theory morphism between the endomorphism theories of $ U: \R_A $ and $ U: \R_B $. This allows us to show:
\begin{lemma}\label{lem:elementary-full}
  The functor is full.
\end{lemma}
\begin{proof}
  For any $ \lambda $-theory $ L $, Theorem \ref{thm:Scott} gives an isomorphism of $ \lambda $-theories $ \eta_L: L \xrightarrow \sim E_{\R_{L_0}}(U) $, with
  \[ {\eta_L}_0(f) = \lambda x_1, \iota_{0, 1}(f) \quad \text{and} \quad {\eta_L^{-1}}_0(g) = g(\lambda x_1, x_1). \]

  Now, for $ L, L^\prime: \LamTh $ and $ F: \Alg{\Lambda}(L_0, L^\prime_0) $, we have
  \[ \eta_L \cdot F \cdot \eta_{L^\prime}^{-1} : \LamTh(L, L^\prime), \]
  and we have for all $ s : L_0 $,
  \[ ({\eta_L}_0 \cdot F \cdot {\eta_{L^\prime}^{-1}}_0)(s) = (\lambda x_1, \iota_{0, 1}(F(s))) (\lambda x_1, x_1) = F(s), \]
  which shows that the functor is full.
\end{proof}

Now, we only have to show:
\begin{lemma}\label{lem:elementary-faithful}
  The functor is faithful.
\end{lemma}
\begin{proof}
  Take morphisms $ F, G: \LamTh(L, L^\prime) $. Suppose that $ F_0 = G_0 $. Then, for all $ s: L_n $, we have
  \[ F_n(s) = \rho^n(F_0(\lambda^n(s))) = \rho^n(G_0(\lambda^n(s))) = G_n(s), \]
  so $ F = G $.
\end{proof}

Summarizing,
\begin{theorem}\label{thm:elementary-fundamental-theorem}
  The functor that sends $ L : \LamTh $ to $ L_0 : \Alg{\Lambda} $, is an adjoint equivalence.
\end{theorem}
\begin{proof}
  By Lemma \ref{lem:elementary-full} and Lemma \ref{lem:elementary-faithful}, the functor is fully faithful. By Lemma \ref{lem:elementary-essentially-surjective}, it is essentially surjective, so it is a weak equivalence. Since $ \LamTh $ and $ \Alg{\Lambda} $ are univalent categories, Lemma \ref{lem:univalen-category-equivalence} shows that $ F $ is an adjoint equivalence.
\end{proof}

\section{Hyland's Proof}

Hyland gives a more category theoretical proof. That means that there is more high-level intuition why things work the way they work, but on the flip side, there is a lot more details to check.

\subsection{Terms of a \texorpdfstring{$ \Lambda $}{Lambda}-algebra}

\begin{definition}
  Take $ \mathbf 1_n = (\lambda x_1 \dots x_n, x_1 \dots x_n) \bullet () : A $.
\end{definition}

\begin{remark}
  Note that we have $ \mathbf 1_1 = U : \R_A $.
\end{remark}

\begin{definition}
  In this section, we consider sets of elements of $ A $ that behave like functions in $ n $ variables:
  \[ A_n = \{ a : A \mid (\lambda x_2 x_3 \dots x_{n + 1}, x_1 x_2 x_3 \dots x_{n + 1}) \bullet a = a \}. \]
\end{definition}

\begin{remark}
  Some straightforward rewriting, shows that
  \[ A_n = \{ a : A \mid \mathbf 1_n \circ a = a \}. \]
\end{remark}

\begin{remark}
  Also note that $ \mathbf 1_n \circ a \circ \mathbf 1_n = \mathbf 1_n \circ a $, so for $ a : A_n $, $ a \circ \mathbf 1_n = a $.
\end{remark}

The following shows that `functions in $ n $ variables' are indeed all in $ A_n $:
\begin{lemma}
  For $ t: \Lambda_{m + n} $ and $ a_1, \dots, a_m: A $, we have $ (\lambda^n t) \bullet (a_1, \dots, a_m) : A $ and we have
  \[ \mathbf 1_n \circ ((\lambda^n t) \bullet (a_1, \dots, a_m)) = (\lambda^n t) \bullet (a_1, \dots, a_m), \]
  so $ (\lambda^n t) \bullet (a_1, \dots, a_m) : A_n $.
\end{lemma}
\begin{proof}
  This follows by straightforward rewriting.
\end{proof}

\begin{corollary}
  By the previous remark,
  \[ ((\lambda^n t) \bullet (a_1, \dots, a_m)) \circ \mathbf 1_n = (\lambda^n t) \bullet (a_1, \dots, a_m). \]
\end{corollary}
\begin{corollary}
  In particular, $ \mathbf 1_m \circ \mathbf 1_n = \mathbf 1_{\max(m, n)} $. From this, it follows that $ A_m \subseteq A_n $ for $ m \leq n $. It also follows that $ a \mapsto \mathbf 1_n \circ a $ gives a function from $ A $ to $ A_n $ (and also from $ A_m \subseteq A $ to $ A_n $).
\end{corollary}

\begin{definition}[\coqident{AlgebraicTheories.FundamentalTheorem.AlgebraToTheory}{lambda_algebra_monoid}]
  We make $ A_1 $, the `functional elements' of $ A $, into a monoid under composition $ \circ $ with unit $ \mathbf 1_1 $. The fact that this is a monoid follows from the remarks above.
\end{definition}

Recall that we have an equivalence $ [\op{C_{A_1}}, \SET] \cong \RAct{A_1} $.

\begin{remark}\label{rem:ract-presheaf-equivalence}
  Note that, like in the last chapter, $ \R_A $ pops up as the Karoubi envelope of the monoid category $ C_{A_1} $, and fits into the following diagram:
  \begin{center}
    \begin{tikzcd}
      & C_{A_1} \arrow[d, hookrightarrow, "\yo"] \arrow[r, hookrightarrow, "\iota_{C_{A_1}}"] & \R_A \arrow[d, hookrightarrow, "\yo"]\\
      \RAct{A_1} & P C_{A_1} \arrow[l, "\sim"] & P \R_A \arrow[l, "\sim"]
    \end{tikzcd}
  \end{center}
  Explicitly, this gives the embedding $ \R_A(\mathbf 1_1, -): \R_A \hookrightarrow \RAct{A_1} $ given by
  \[ X \mapsto \R_A(\mathbf 1_1, X) = \{ x : A \mid X \circ x = x \}. \]
  Also, note that if $ A = L_0 $ for some $ \lambda $-theory $ L $, then the monoid $ A_1 $ is equivalent to the monoid $ L_1 $, and $ \R_A $ is equivalent to our familiar category of retracts $ \R $. Using Lemma \ref{lem:equivalent-presheaf-cats}, we have the following 2-commutative diagram:
  \begin{center}
    \begin{tikzcd}
      &
      C_{{L_0}_1} \arrow[dd, "\yo" description, near start, hook] \arrow[rrr, "\iota_{C_{{L_0}_1}}" description, hook] \arrow[rd, "\sim" description, no head] & & & \R_{L_0} \arrow[dd, "\yo" description, near start, hook] \arrow[rd, "\sim" description, no head] & & \\
      &
      & C_{L_1} \arrow[dd, "\yo" description, near start, hook] \arrow[r, hook] & \mathbf L \arrow[rr, hook] \arrow[dd, "\yo" description, near start, hook] & & \mathbf R \arrow[dd, "\yo" description, near start, hook] \arrow[rdd, hook] & \\
      \RAct{{L_0}_1} &
      P C_{{L_0}_1} \arrow[l, "\sim"'] \arrow[rd, "\sim" description, no head] & & & P \R_{L_0} \arrow[lll, "\sim" description] \arrow[rd, "\sim" description, no head] & & \\
      &
      & P C_{L_1} & P \mathbf L \arrow[l, "\sim" description] & & P \R \arrow[ll, "\sim" description] & \Pshf L \arrow[lll, "\sim" description, bend left]
    \end{tikzcd}
  \end{center}
\end{remark}

\subsection{Constructing a theory from an algebra}

\begin{definition}
  Composition $ \circ $ gives a right $ A_1 $-action on the $ A_n $, so we have $ A_n : \RAct{A_1} $. In particular, $ A_1 $ acts on itself, and we will call this set with right $ A_1 $-action $ U_A $.
\end{definition}

\begin{lemma}[\coqident{AlgebraicTheories.FundamentalTheorem.AlgebraToTheory}{universal_monoid_exponential_iso}]
  $ A_2 $ is isomorphic to the exponential object $ U_A^{U_A} $ in $ \RAct{A_1} $.
\end{lemma}
\begin{proof}
  Recall that $ U_A^{U_A} $ is the set of $ A_1 $-equivariant morphisms $ U_A \times U_A \to U_A $. We have an isomorphism $ \psi: A_2 \xrightarrow \sim U_A^{U_A} $, given by
  \[ \psi(f) = (b, b^\prime) \mapsto (\lambda x_4, x_1 (x_2 x_4) (x_3 x_4)) \bullet (f, b, b^\prime), \]
  treating $ f : A_2 $ as a function in two variables, and simultaneously composing it with the functions $ b, b^\prime : A_1 $. It has an inverse
  \[ \psi^{-1}(g) = (\lambda x_2 x_3, x_1 (x_2, x_3)) \bullet (g(\pi_1, \pi_2)). \]
  Note that the first pair $ (x_2, x_3) $ is a $ \lambda $-term, whereas the second pair $ (\pi_1, \pi_2) $ is a pair in $ U_A \times U_A $.

  For $ f: U_A^{U_A} $ and $ (a_1, a_2): U_A \times U_A $, we have
  \[
    \psi(\psi^{-1}(f))(a_1, a_2)
    = f(\pi_1, \pi_2) \circ \langle a_1, a_2 \rangle
    = f(\pi_1 \circ \langle a_1, a_2 \rangle, \pi_2 \circ \langle a_1, a_2 \rangle)
    = f(a_1, a_2).
  \]
  Here we use the $ A_1 $-equivariance of $ f $. In the last step of this proof, we use, among other things, the fact that the $ a_i : A_1 $ and therefore $ \lambda x_1, a_i x_1 = a_i $.

  Some straightforward rewriting shows that for $ a: A_2 $, we have $ \psi^{-1}(\psi(a)) = a $. In the last step of this proof, we use the fact that $ a : A_2 $ and therefore $ \lambda x_1 x_2, a x_1 x_2 = a $.

  Therefore, $ \psi $ is a bijection and, as it turns out, an isomorphism.
\end{proof}

\begin{remark}
  Recall that the embedding $ \R_A \hookrightarrow \RAct{A_1} $ is the composition of a Yoneda embedding and two adjoint equivalences. These all preserve exponential objects (see Lemma \ref{lem:Yoneda-preserves-exponentials}). Now, note that $ A_1 $ is the image of $ U : \R_A $, so the exponential $ U_A^{U_A} $ is $ A_2 $, the image of $ U^U = \lambda x_1 x_2, x_1 x_2 = \mathbf 1_2 $.
\end{remark}

\begin{definition}[\coqident{AlgebraicTheories.FundamentalTheorem.AlgebraToTheory}{lambda_algebra_theory}]\label{def:lambda-algebra-to-lambda-theory}
  Recall that $ A_2 \subseteq U_A $, and that we have a retraction $ a \mapsto \mathbf 1_2 \circ a : U_A \to A_2 $.

  Therefore, $ U_A $ is a reflexive object in $ \RAct{A_1} $, and we get a $ \lambda $-theory $ E(U_A) $.
\end{definition}

\begin{remark}
  The cartesian closed embedding of $ \R_A $ into $ \RAct{A_1} $ sends $ U $ to $ U_A $. It sends the retraction $ U^U: \R_A(U, U^U) $ exactly to the retraction $ a \mapsto \mathbf 1_2 \circ a: \RAct{A_1}(U_A, A_2) $. Therefore, we have a $ \lambda $-theory isomorphism $ E_{\R_A}(U) \cong E_{\RAct{A_1}}(U_A) $.
\end{remark}

\subsection{Constructing a theory morphism from an algebra morphism}

Take a morphism $ F: \Alg{\Lambda}(A, B) $. Note that $ F $ preserves $ \circ $ and the $ \mathbf 1_n $. Therefore, it induces a monoid morphism $ A_1 \to B_1 $, which gives a functor $ C_{A_1} \to C_{B_1} $. Precomposing with this, we get a functor $ \RAct{B_1} \to \RAct{A_1} $.

To get a morphism $ E_{\RAct{A_1}}(U_A) \to E_{\RAct{B_1}}(U_B) $ however, we need a functor $ \RAct{A_1} \to \RAct{B_1} $, which we obtain by Left Kan extension: see Lemma \ref{lem:scalar-extension} (the ``tensor product'').

Hyland gives a very high-level argument why $ F_* $ induces a morphism $ \bar F : \LamTh(E_{\RAct{A_1}}(U_A), E_{\RAct{B_1}}(U_B)) $, which we will discuss a bit more here.

\begin{lemma}
  The extension of scalars $ F_* $ sends $ U_A $ to $ U_A $ and preserves finite products.
\end{lemma}
\begin{proof}
  By Lemma \ref{lem:scalar-extension-monoid-monoid-action}, we have $ F_*(U_A) \cong U_A $.

  We will show that $ F_* $ preserves binary products and the terminal object, because from this it follows that $ F_* $ preserves all finite products.

  We use Lemma \ref{lem:scalar-extension-terminal} to show that $ F_* $ preserves the terminal object. We take (very similar to the terminal object in $ \R $):
  \[ a_0 = (\lambda x_1 x_2, x_2) \bullet () : A_1 \quad \text{and} \quad b_0 = (\lambda x_1 x_2, x_2) \bullet () : B_1 \]
  and $ a_0 $ is weakly terminal because for all $ a : B_1 $, we have $ F(a_0) \circ a = b_0 $.

  We use Lemma \ref{lem:scalar-extension-product} to show that $ F_* $ also preserves the product. Therefore, given $ a_1, a_2 : B_1 $. Take $ b = \langle a_1, a_2 \rangle $, together with the familiar projections $ \pi_i : A_1 $. We have $ a_i = F(\pi_i) \circ a $.

  Now, for some $ b^\prime: B_1 $ and $ \pi_1^\prime, \pi_2^\prime: A_1 $ such that $ a_i = F(\pi_i^\prime) \circ b^\prime $, take $ m = \langle \pi_1^\prime, \pi_2^\prime \rangle $. Then $ \pi_i \circ m = \pi_i^\prime $ and $ F(m) \circ a^\prime = a $, so $ (a, \pi_1, \pi_2) $ is weakly terminal and $ F_* $ preserves binary products.

  Since any finite product is (isomorphic to) a construction with a repeated binary product and the terminal object, the fact that $ F_* $ preserves binary products and the terminal object shows that $ F_* $ preserves all finite products.
\end{proof}

Now, we can start defining our lift of $ F $:
\begin{definition}
  We can send an element $ g: E(U_A)_n = \RAct{A}(U_A^n, U_A) $ to
  \[ F_*(g): \RAct{A^\prime}(f(U_A^n), f(U_A)) \cong \RAct{A^\prime}((U_{A^\prime})^n, U_{A^\prime}) = E(U_{A^\prime})_n \]
  so we have a morphism $ \bar F: \LamTh(E(U_A), E(U_{A^\prime})) $.
\end{definition}

\begin{remark}
  The fact that $ \bar F $ preserves the variables and substitution is not very hard, since these are just defined in terms of finite products of $ U_A $ and $ \bar F $ preserves finite products and $ U_A $.

  However, showing that it is a $ \lambda $-theory morphism is a different matter. Hyland claims

  \enquote{$ F $ preserves $ \mathbf 1_n $, which determines the function space as a retract of the universal. So $ \bar F $ preserves the retract and the result follows.}

  Although this covers the core of the argument, it is very complicated to actually verify that this works, because we need to pass through a lot of isomorphisms, and check that they work nicely together:
  \begin{align*}
    \alpha_A: \RAct{A_1}(X \times Y, Z) &\xrightarrow{\sim} \RAct{A_1}(X, Z^Y);\\
    \beta: F_*(U_A) &\xrightarrow{\sim} U_{A^\prime};\\
    \bar \gamma: F_*(A \times B) &\xrightarrow{\sim} F_*(A) \times F_*(B);\\
    \gamma_n: F_*(X^n) &\xrightarrow{\sim} F_*(X)^n;\\
    % \delta: F_*(X^Y) &\xrightarrow{\sim} F_*(X)^{F_*(Y)};\\
    \delta_A: U_A^{U_A} &\xrightarrow{\sim} A_2.
  \end{align*}
  Since we already motivated this in a different way, we will leave it as an exercise for the enthousiastic reader.
  % with $ \gamma_{n + 1} = \bar{\gamma} \cdot (\gamma_n \times \id X) $.
  % Then, for $ s: E(U_A)_{n + 1} $, we have $ \lambda_A(s) = \alpha_A(s) \cdot \delta_A \cdot \pi_A : \RAct{A_1}(U_A^n, U_A) $ for the projection $ \pi_A: A_2 \to U_A $. However, note that $ f^*(\lambda_A(s)): \RAct{A^\prime_1}(f^*(U_{A^\prime}^n), f^*(U_{A^\prime})) $. To compare this to $ \lambda_{A^\prime}(\dots) $, we actually need to take
  % \[ (\beta^{-1})^n \cdot \gamma_n^{-1} \cdot f^*(\lambda_A(s)) \cdot \beta : \RAct{A^\prime_1}(U_A^n, U_A). \]
  % On the other hand, we also have $ f^*(s): \RAct{A^\prime_1}(f^*(U_A^{n + 1}), f^*(U_A)) $ and we cannot apply $ \lambda_{A^\prime} $ directly. Instead, the term that we end up with is
  % \[ \lambda_{A^\prime}((\beta^{-1})^{n + 1} \cdot \gamma_{n + 1}^{-1} \cdot f^*(s) \cdot \beta): \RAct{A^\prime_1}(U_A^n, U_A). \]
  % So the equality that we need to prove is (using functoriality of $ f^* $ and naturality of $ \alpha_{A^\prime} $):
  % \begin{align*}
  %   &(\beta^{-1})^n \cdot \gamma_n^{-1} \cdot f^*(\alpha_A(s)) \cdot f^*(\delta_A \cdot \pi_A) \cdot \beta\\
  %   &= (\beta^{-1})^n \cdot \gamma_n^{-1} \cdot \alpha_{A^\prime}((\id X^n \times \beta^{-1}) \cdot \bar{\gamma}^{-1} \cdot f^*(s)) \cdot \beta^{U_A} \cdot \delta_{A^\prime} \cdot \pi_{A^\prime}.
  % \end{align*}
  % Because of the complicated definition of each of these terms, I was unable to verify the correctness of this statement (and the similar statement about $ \rho: E(U_A)_n \to E(U_A)_{n + 1} $) within a day, even though I am willing to believe Hyland's claim.

  % Given a morphism $ t: X \times Y \to Z $, $ \alpha_{A_1}(t): X \to (U_A \times Y \to Z) $ is given by
  % \[ \alpha(t)(x)(a, y) = t(x a, y) \]

  % Also, $ \beta: f^*(U_A) \xrightarrow{\sim} U_{A^\prime} $ is given, for $ a: A_1 $ and $ a^\prime : A^\prime_1 $, by
  % \[ \beta(a, a^\prime) = f(a) a^\prime \quad \text{and} \quad \beta^{-1}(a^\prime) = (1, a^\prime). \]

  % Given a morphism $ s: X \to Y $, we have $ f^*(s): f^*(X) \to f^*(Y) $ given by
  % \[ f^*(s)(x, a^\prime) = (s(x), a^\prime). \]

  % Finally, we have
  % \[ \delta(s) = \lambda x_1 x_2, s(p_1, p_2)(\lambda x_3, x_3 x_1 x_2) \]
  % with $ p_i = \lambda x_1, x_1 (\lambda x_2 x_3, x_{i + 1}) $.

  % For some $ s: U_A^{n + 1} \to U_A $, the left hand side sends $ (a, (a^\prime_1, \dots, a^\prime_n)): f^*(U_A^n) $ to
  % \begin{align*}
  %   &\lambda x_1 x_2, f(s((a_i p_1)_i, p_2)) (\lambda x_3, x_3 x_1 x_2) \circ a^\prime\\
  %   &= \lambda x_1 x_2, f(s((a_i p_1)_i, p_2)) (\lambda x_3, x_3 a^\prime (x_1) x_2)
  % \end{align*}
  % and the right hand side sends it to
  % \begin{align*}
  %   \lambda x_1 x_2, \lambda x_3, (f(s((a_i p_1)_i, p_2))((\lambda x_4, x_4 (a^\prime p_1 (\lambda x_3, x_3 x_1 x_2)) (p_2 (\lambda x_3, x_3 x_1 x_2)))(x_3)))
  % \end{align*}
\end{remark}

\begin{lemma}
  For $ F = \id A $, we have $ \bar F = \id{E(U_A)} $.
\end{lemma}
\begin{proof}
  By the reasoning set forth in Lemma \ref{lem:elementary-faithful}, we only need to check $ \bar F_0 $. Given $ s : \RAct{A_1}(I, U_A) $, we have
  \[ \bar F_0(s) = \gamma^{-1} \cdot F_*(s) \cdot \beta: \RAct{A_1}(I, U_A) \]
  for $ \gamma: F_*(I) \cong I $ and $ \beta: F_*(U_A) \cong U_A $. Then
  \[
    \bar{\id A}(s)(\star) = s(\star) \circ ((\lambda x_1 x_2, x_2) \bullet ()) = s(\star \circ ((\lambda x_1 x_2, x_2) \bullet ())),
  \]
  so $ \bar{\id A}_0(s) = s $ and we can conclude that $ \bar{\id A} = \id{E(U_A)} $.
\end{proof}

\begin{lemma}
  For $ F : \Alg{\Lambda}(A, B) $ and $ G: \Alg{\Lambda}(B, C) $, we have $ \bar F \cdot \bar G = \overline{F \cdot G} $.
\end{lemma}
\begin{proof}
  Again, we only have to check at the terms without free variables. Given $ s : \RAct{A_1}(I, U_A) $, we have
  \[ (\bar F \cdot \bar G)(s) = \gamma_G^{-1} \cdot G_*(\gamma_F^{-1} \cdot F_*(s) \cdot \beta_F) \cdot \beta_G: \RAct{C_1}(I, U_C) \]
  for $ \gamma: F_*(I) \cong I $ and $ \beta: F_*(U_A) \cong U_A $. Then
  \begin{align*}
    (\bar F \cdot \bar G)(s)(\star)
    &= G(F(s(\star)) \circ ((\lambda x_1 x_2, x_2) \bullet_B ())) \circ ((\lambda x_1 x_2, x_2) \bullet_C ())\\
    &= G(F(s(\star \circ ((\lambda x_1 x_2, x_2) \bullet_A ()) \circ ((\lambda x_1 x_2, x_2) \bullet_A ()))))\\
    &= G(F(s(\star)))\\
    &= (F \cdot G)^{-1}(s(\star \circ ((\lambda x_1 x_2, x_2) \bullet_A ())))\\
    &= \overline(F \cdot G)(s)(\star)
  \end{align*}
  so $ (\bar F \cdot \bar G)_0(s) = (\overline{F \cdot G})_0(s) $ and we can conclude that $ \bar F \cdot \bar G = \overline{F \cdot G} $.
\end{proof}

\begin{definition}
  We get a functor from $ \Alg{\Lambda} $ to $ \LamTh $, sending objects $ A $ to $ E_{\RAct{A_1}}(U_A) $ and morphisms $ F: \Alg{\Lambda}(A, B) $ to $ \bar F: E(U_A) \to E(U_B) $.
\end{definition}

\begin{remark}
  Note that for $ X : \R_A $, we have a natural isomorphism of sets with a right $ B_1 $-action
  \[ \psi: \{ f : B \mid F(X) \circ f = f \} \xrightarrow \sim \{ f : A \mid X \circ f = f \} \times B_1 / \sim \]
  given by
  \[ \psi(f) = (X, f) \quad \text{and} \quad \psi^{-1}(f, b) = F(f) \circ b. \]
  % which is $ B_1 $-equivariant and natural in $ X $.
  % We have
  % \[ \psi^{-1}(\psi(f)) = \psi^{-1}(X, f) = F(X) \circ f = f \]
  % \[ \psi(\psi^{-1}(f, b)) = \psi(F(f) \circ b) = (X, F(f) \circ b) = (X \circ f, b) = (f, b) \]
  % We need to show that this is natural in $ X $. Therefore, take $ g : \R_A(X, Y) $. Then $ \R_B(\mathbf 1_1, F(g)) $ is given by postcomposition with $ F(g) $. Also, $ F_*(\R_A(\mathbf 1_1, g)) $ is given by postcomposing with $ g $ on the component $ \R_A(\mathbf 1_1, g) $. Then
  % \[ \psi(F(g) \circ f) = (Y, F(g) \circ f) = (Y \circ g, f) = (g \circ X, f) \]

  Therefore, the following diagram $ 2 $-commutes:
  \begin{center}
    \begin{tikzcd}
      \R_A \arrow[r, "F"] \arrow[d, "{\R_A(\mathbf 1_1, -)}"] & \R_B \arrow[d, "{\R_B(\mathbf 1_1, -)}"]\\
      \RAct{A_1} \arrow[r, "F_*"] & \RAct{B_1}
    \end{tikzcd}
  \end{center}
  Since $ F $ preserves all the structure of $ \R_A $, as do the embeddings of $ \R_A $ and $ \R_B $ into $ \RAct{A_1} $ and $ \RAct{B_1} $, one would expect $ F_* $ to preserves the structure of the full subcategory $ \R_A $ of $ \RAct{A_1} $, including $ U_A $, its finite products and their exponentials. This is another way to argue that $ \bar F $ is indeed a morphism of $ \lambda $-theories.
\end{remark}

\subsection{The unit}

Definining the unit of the adjunction boils down to a version of Scott's representation theorem.

\begin{lemma}
  For a $ \lambda $-theory $ L $, we can define a $ \lambda $-theory isomorphism
  \[ \eta_L: L \xrightarrow{\sim} E(U_{L_0}). \]
\end{lemma}
\begin{proof}
  Recall from Remark \ref{rem:ract-presheaf-equivalence} that we have a chain of equivalences
  \[ \Pshf L \xrightarrow \sim P \mathbf L \xrightarrow \sim P C_{L_1} \xrightarrow \sim P C_{{L_0}_1} \xrightarrow \sim \RAct{{L_0}_1}. \]
  It sends the presheaf $ L^n $ to the set $ L_1^n $ with a right action sending $ s: L_1^n $ and $ t: (L_0)_1 $ to $ (s_i \bullet_L \rho(t))_i : L_1^n $. We have an isomorphism $ s \mapsto (\lambda(s_i))_i: (L_1)^n \to U_{L_0} $, with inverse $ (\rho_i)_i : s \mapsto (\rho(s_i))_i $.

  Then $ \eta_L $ arises by combining this with the isomorphism from Scott's representation theorem (Theorem \ref{thm:representation-theorem})
  \[ \eta_L: L \xrightarrow \sim E_{\Pshf L}(L) \xrightarrow \sim E_{\RAct{{L_0}_1}}(U_{L_0}). \]
  It is quite easy to work out that we can make this explicit as (dropping the $ n $ and just writing $ \eta_L $)
  \[ \eta_n:
    L_n
      \xrightarrow{f \mapsto ((s : \Pshf{L_m^n}) \mapsto f \bullet s)_m}
    \Pshf L(L^n, L)
      \xrightarrow{f \mapsto f_1}
    \RAct{(L_0)_1}(L_1^n, L_1),
      \xrightarrow{\lambda \circ - \circ (\rho_i)_i}
    \RAct{(L_0)_1}(U_{L_0}^n, U_{L_0}),
  \]
  so $ \eta_n(f)(s) = \lambda(f \bullet (\rho(s_i))_i) $ for $ f: L_n $ and $ s: U_{L_0}^n $.
\end{proof}

\begin{remark}
  Note that we can do the same with Scott's version of his representation theorem, using the chain of equivalences and an embedding
  \[ \mathbf R \xrightarrow \sim \mathbf R_{L_0} \xrightarrow{\yo} P \R_{L_0} \xrightarrow \sim P C_{{L_0}_1} \xrightarrow \sim \RAct{{L_0}_1}, \]
  Here, it is a bit harder to get an explicit formula for $ \eta $, because we need to do a bit more conversion between $ U_A^n $ and the image of $ U^n $ after the embedding $ \varphi: \mathbb R \hookrightarrow \RAct{{L_0}_1} $. If we quickly define $ \lambda $-terms
  \[ \langle x_i \rangle_i = \langle x_1, \dots, x_n \rangle = \langle \langle \dots \langle (\lambda x_{n + 1} x_{n + 2}, x_{n + 2}), x_1 \rangle, \dots\rangle, x_n \rangle \]
  and corresponding tuples $ (x_i)_i $ and projections $ \pi_i $, we have
  \[ L_n \xrightarrow{f \mapsto \lambda(f \bullet (\pi_i x_1)_i)} \mathbb R(U^n, U) \xrightarrow{f \mapsto f \circ -} \RAct{{L_0}_1}(\varphi(U^n), U_{L_0}) \xrightarrow{(s \mapsto \langle s_i \rangle_i) \circ -} \RAct{{L_0}_1}(U_{L_0}^n, U_{L_0}). \]
  and in the end, we obtain the very same explicit formula
  \[ \eta_n(f)(s) = \iota_{0, n}(f)(x_i)_i \circ (\langle s_i \rangle_i) = \lambda(f \bullet (\rho(s_i))_i). \]
\end{remark}

\begin{lemma}
  $ \eta $ is natural in $ L $. That is, for all $ F: \LamTh(L, L^\prime) $, the following diagram commutes:
  \begin{center}
    \begin{tikzcd}
      L \arrow[r, "F"] \arrow[d, "\eta_L"] & L^\prime \arrow[d, "\eta_{L^\prime}"]\\
      E_{\RAct{{L_0}_1}}(U_{L_0}) \arrow[r, "\bar{F_0}"] & E_{\RAct{{L^\prime_0}_1}}(U_{L^\prime_0})
    \end{tikzcd}
  \end{center}
\end{lemma}
\begin{proof}
  We must show
  \[ \eta_L \cdot \bar{F_0} = F \cdot \eta_{L^\prime}. \]
  Note that for all $ s : L_0 $,
  \begin{align*}
    \bar{F_0}_0(\eta_L(s))
    &= \gamma_{F_0}^{-1} \cdot {F_0}_*(\star \mapsto (\lambda x_1, \iota_{0, 1}(s))) \cdot \beta_F\\
    &= \star \mapsto F_0(\lambda x_1, \iota_{0, 1}(s)) \circ ((\lambda x_1 x_2, x_2) \bullet ())\\
    &= \star \mapsto (\lambda x_1, \iota_{0, 1}(F_0(s)))\\
    &= \eta_{L^\prime}(F_0(s))
  \end{align*}
  and by Lemma \ref{lem:elementary-full}, this concludes the proof.
\end{proof}

\subsection{The counit}

\begin{definition}
  For $ A : \Alg \Lambda $, we define a bijection $ \epsilon_A : E_{\RAct{A_1}}(U_A)_0 \cong A $ as
  \[ \epsilon_A(s) = x_1 (\lambda x_2, x_2) \bullet (s(\star)) \quad \text{and} \quad \epsilon_A^{-1}(a)(\star) = (\lambda x_2, x_1) \bullet a. \]
  These are inverses because $ s(\star) $ is $ A_1 $-equivariant (Lemma \ref{lem:global-action-elements}), and then
  \[ (\lambda x_2, x_1 (\lambda x_3, x_3)) \bullet s(\star) = s(\star) \circ ((\lambda x_1 x_2, x_2) \bullet ()) = s(\star). \]
\end{definition}

We want to show that $ \epsilon_A $ is an isomorphism of $ \Lambda $-algebras. We use Lemma \ref{lem:make-is-lambda-algebra-morphism} for this, so we need to show that it preserves the application and the $ \Lambda $-definable constants.

\begin{lemma}
  We have for all $ a, b: E(U_A)_0 $,
  \[ \epsilon_A((x_1 x_2) \bullet (a, b)) = (x_1 x_2) \bullet (\epsilon_A(a), \epsilon_A(b)). \]
\end{lemma}
\begin{proof}
  For $ a, b: E(U_A)_0 $, we have, using at some point the isomorphism $ \delta: \RAct{A_1}(U_A^{U_A}, A_2) $,
  \begin{align*}
    \epsilon_A((x_1 x_2) \bullet (a, b)) &= (x_1 (\lambda x_3, x_3) (x_2 (\lambda x_3, x_3))) \bullet (a(\star), b(\star))\\
    &= (x_1 x_2) \bullet (\epsilon_A(a), \epsilon_A(b))
  \end{align*}
  and this concludes the proof.
\end{proof}

To show that $ \epsilon $ preserves the $ \Lambda $-definable constants, we first need to show two properties of $ \epsilon $ and $ \eta $:
\begin{lemma}\label{lem:counit-natural}
  $ \epsilon $ is natural in $ A $. That is, for all $ F: \Alg{\Lambda}(A, B) $, the following diagram commutes:
  \begin{center}
    \begin{tikzcd}
      E(U_A)_0 \arrow[d, "\epsilon_A"] \arrow[r, "\bar F_0"] & E(U_B)_0 \arrow[d, "\epsilon_B"]\\
      A \arrow[r, "F"] & B
    \end{tikzcd}
  \end{center}
\end{lemma}
\begin{proof}
  The functor $ F_* : \RAct{A_1} \to \RAct{B_1} $ sends $ X : \RAct{A_1} $ to $ X \times B_1 / \sim : \RAct{B_1} $. We have isomorphisms
  \[ \beta: F_*(U_A) \xrightarrow \sim U_B \quad \text{and} \quad \gamma: F_*(I) \xrightarrow \sim I, \]
  with
  \[ \beta(a, b) = F(a) \circ b \quad \text{and} \quad \gamma^{-1}(\star) = (\star, (\lambda x_1 x_2, x_2) \bullet ()). \]
  Then $ \bar F: \RAct{A_1}(I, U_A) \to \RAct{B_1}(I, U_B) $ is given by
  \[
    \bar F(s)(\star)
    = \gamma^{-1} \cdot (s \times \id{B_1}) \cdot \beta
    = (\lambda x_2, x_1 (\lambda x_3, x_3)) \bullet F(s(\star)),
  \]
  so
  \[
    (\bar F \cdot \epsilon_B)(s)
    = (x_1 (\lambda x_2, x_2)) \bullet F(s(\star))
    = (\epsilon_A \cdot F)(s),
  \]
  which concludes the proof.
\end{proof}

\begin{lemma}\label{lem:zigzag}
  $ \epsilon $ and $ \eta $ satisfy one of the zigzag identities.
\end{lemma}
\begin{proof}
  In this case, the zigzag identity on $ L \mapsto L_0 $ boils down to the following diagram commuting for all $ L : \LamTh $:
  \begin{center}
    \begin{tikzcd}
      L_0 \arrow[rr, "\id{L_0}"] \arrow[rd, "{\eta_L}_0"] & & L\\
      & E(U_{L_0})_0 \arrow[ru, "\epsilon_{L_0}"]
    \end{tikzcd}
  \end{center}
  Now, note that for all $ f : L_0 $,
  \[
    ({\eta_L}_0 \cdot \epsilon_{L_0})(f)
    = (x_1 (\lambda x_2, x_2)) \bullet (\lambda x_1, \iota_{0, 1}(f))
    = f,
  \]
  which shows that the diagram commutes.
\end{proof}

Now, finally, we are ready to show that $ \epsilon $ is an isomorphism of $ \Lambda $-algebras:
\begin{lemma}
  We have for all $ s: \Lambda_0 $,
  \[ \epsilon_A(s \bullet ()) = s \bullet (). \]
\end{lemma}
\begin{proof}
  Consider the following diagram, with $ F: \Alg \Lambda(\Lambda_0, A) $ given by $ F(s) = s \bullet () $:
  \begin{center}
    \begin{tikzcd}
      E(U_{\Lambda_0})_0
        \arrow[r, "\bar F_0"]
        \arrow[d, "\epsilon_{\Lambda_0}"]
      & E(U_A)_0
        \arrow[d, "\epsilon_A"]\\
      \Lambda_0
        \arrow[r, "F"]
        \arrow[u, bend left, "\eta_0"]
      & A
    \end{tikzcd}
  \end{center}
  By Lemma \ref{lem:counit-natural}, the square commutes and by Lemma \ref{lem:zigzag}, we have $ \eta_0 \cdot \epsilon_{\Lambda_0} = \id{\Lambda_0} $.

  Recall that there exists a unique morphism $ \iota_\Lambda: \LamTh(\Lambda, E(U_A)) $, and that for all $ s: \Lambda_0 $, by definition $ s \bullet_{E(U_A)_0} () = \iota_\Lambda(s) \bullet_{E(U_A)} () = \iota_\Lambda(s) $. Since we have $ \eta \cdot \bar F : \LamTh(\Lambda, E(U_A)) $, we must have $ \iota_\Lambda = \eta \cdot \bar F $ and
  \begin{align*}
    \epsilon_A(s \bullet_{E(U_A)} ())
    &= \epsilon_A(\bar{F_0}(\eta_0(s)))\\
    &= F(\epsilon_{\Lambda_0}(\eta_0(s)))\\
    &= F(s)\\
    &= s \bullet_A (),
  \end{align*}
  which concludes the proof.
\end{proof}

\subsection{The equivalence}

By Lemma 3.2 in \autocite{nlab:adjoint_equivalence} and Lemma \ref{lem:zigzag}, $ \eta $ and $ \epsilon $ satisfy both zigzag identities, and we can state the fundamental theorem of the $ \lambda $-calculus:
\begin{theorem}\label{thm:Hyland-fundamental-theorem}
  There is an adjoint equivalence $ \LamTh \cong \Alg{\Lambda} $, sending a $ \lambda $-theory $ L $ to the $ \Lambda $-algebra $ L_0 $, with an inverse functor that sends a $ \Lambda $-algebra $ A $ to the theory $ E_{\RAct{A_1}}(U_A) $.
\end{theorem}

\begin{remark}\label{rem:alternative-algebra-to-theory}
  Hyland remarks that the isomorphism $ U_A^{U_A} \cong A_2 $ can be generalized to isomorphisms $ U_A^{U_A^n} \cong A_{n + 1} $.
  \begin{align*}
    \RAct{A_1}(U_A^n, U_A)
    &\cong \RAct{A_1}(I, U_A^{U_A^n})\\
    &\cong \RAct{A_1}(I, A_{n + 1})\\
    &\cong \{ f : A_{n + 1} \mid \forall a : A_1, f \circ a = f \}\\
    &\cong A_n.
  \end{align*}
  % In particular, we can pick $ a = \lambda x_1, x_1 (\lambda x_2, x_2) $. Then we have an isomorphism from this subset of $ A_{n + 1} $ to $ A_n $, given by
  % \[ f \mapsto (x_1 (\lambda x_2, x_2)) \bullet f \quad \text{and} \quad g \mapsto (\lambda x_2, x_1) \bullet g. \]
  Explicitly, we get an isomorphism $ \psi: \RAct{A_1}(U_A^n, U_A) \xrightarrow \sim A_n $, given by
  \[ \psi(f) = (\lambda x_2 \dots x_{n + 1}, x_1 (x_2, \dots, x_{n + 1})) \bullet (f (\pi_1, \dots, \pi_n)) \]
  and
  \[ \psi^{-1}(g)(a_1, \dots, a_n) = (\lambda x_{n + 2}, x_1 (x_2 x_{n + 2}) \dots (x_{n + 1} x_{n + 2})) \bullet (g, a_1, \dots, a_n). \]
  Note that to show this, we need to use the $ A_1 $-equivariance of $ f $ at some point:
  \begin{align*}
    &f(\pi_2, \dots, \pi_{n + 1})((\lambda x_{n + 1}, x_{n + 1}), x_1, \dots, x_n)\\
    &= (f(\pi_1, \dots, \pi_n) \circ \langle \pi_2, \dots, \pi_{n + 1} \rangle) ((\lambda x_{n + 2}, x_{n + 2}), x_1, \dots, x_n)\\
    &= f(\pi_1, \dots, \pi_n) (x_1, \dots, x_n).\\
  \end{align*}
  This gives a $ \lambda $-theory structure on $ (A_n)_n $, with
  \begin{align*}
    y_{n, i} &= (\lambda x_1 \dots x_n, x_{n, i}) \bullet ();\\
    f \bullet g &= (\lambda x_{m + 2} \dots x_{m + n + 1}, x_1 (x_2 x_{m + 2} \dots x_{m + n + 1}) \dots (x_{m + 1} x_{m + 2} \dots x_{m + n + 1})) \bullet (f, g_1, \dots, g_m);\\
    \rho(f) &= \mathbf 1_m \circ f;\\
    \lambda(h) &= f.
  \end{align*}
  for $ f: A_m $, $ g: A_n^m $ and $ h: A_{m + 1} $.

  Then any $ F: \Alg \Lambda(A, B) $ gives functions $ F: A_n \to B_n $, and these give a $ \lambda $-theory morphism in $ \LamTh((A_n)_n, (B_n)_n) $.

  The natural isomorphism $ \epsilon_A: A_0 \to A $ is just $ \id A $. Note that, even though $ A_0 = A $ as sets, their $ \Lambda $-algebra structures are defined differently, so it takes some work to show that $ \epsilon_A $ is a $ \Lambda $-algebra morphism. Also, $ {\eta_L}_n : L_n \to (L_0)_n $ is given by $ \lambda^n $, with $ \rho^n $ as its inverse. The zigzag identities are trivial, so this gives another, very elemental proof of the fundamental theorem.
  % \begin{align*}
  %   \psi^{-1}(\psi(f))(b)
  %   &= (\lambda x_{n + 2}, x_1 (x_2 x_{n + 2}) \dots (x_{n + 1} x_{n + 2})) \bullet (\psi(f), b_1, \dots, b_n)\\
  %   &= (\lambda x_{n + 2}, x_1 (x_2 x_{n + 2}, \dots, x_{n + 1} x_{n + 2})) \bullet (f (\pi_1, \dots, \pi_n), b_1, \dots, b_n)\\
  %   &= (x_1 \circ \langle x_2, \dots, x_{n + 1} \rangle) \bullet (f (\pi_1, \dots, \pi_n), b_1, \dots, b_n)\\
  %   &= f (\pi_1, \dots, \pi_n) \circ \langle b_1, \dots, b_n \rangle\\
  %   &= f (\pi_1 \circ \langle b_1, \dots, b_n \rangle, \dots, \pi_n \circ \langle b_1, \dots, b_n \rangle)\\
  %   &= f (b_1, \dots, b_n).
  % \end{align*}
  % \begin{align*}
  %   \psi(\psi^{-1}(g))
  %   &= (\lambda x_2 \dots x_{n + 1}, x_1 (x_2, \dots, x_{n + 1})) \bullet ((\lambda x_{n + 2}, x_1 (x_2 x_{n + 2}) \dots (x_{n + 1} x_{n + 2})) \bullet (g, \pi_1, \dots, \pi_n))\\
  %   &= (\lambda x_2 \dots x_{n + 1}, x_1 x_2 \dots x_{n + 1}) \bullet g\\
  %   &= g.
  % \end{align*}
\end{remark}

\section{The Theory of Extensions}

The fundamental theorem of the $ \lambda $-calculus that Hyland shows is actually not of the form shown above. To get there, we first need to show that the category of $ T $-algebras for an algebraic theory $ T $ has coproducts, and define the `theory of extensions'.

Let $ \llbracket n \rrbracket $ denote the finite set $ \{ 1, 2, \dots, n \} $. For $ T $ an algebraic theory, let $ \mathbf L $ be its corresponding Lawvere theory (Lemma \ref{lem:lawvere-clone}).

\begin{lemma}\label{lem:algebra-coproducts}
  Let $ T $ be an algebraic theory. The category of $ T $-algebras has coproducts.
\end{lemma}
\begin{proof}
  This is shown in \autocite{algebraic-theories-2010}, in the lemmas leading up to Theorem 4.5.

  Explicitly, we can express the coproduct of algebras, and especially its set, as the following coend \autocite[][Proposition 2.5]{Hyland} (see also Section \ref{sec:coends} for more on coends)
  \[ A + B = \int^{(m, n) : \mathbf L \times \mathbf L} T_{m^\prime + n^\prime} \times A^m \times B^n, \]
  considering $ A $ as a covariant functor on $ \mathbf L $ (see Lemma \ref{lem:lawvere-algebra}) and the theory presheaf $ T $ as a presheaf (see Lemma \ref{lem:lawvere-presheaf}).

  Note that we do not need the exact definition of $ A + B $ for the rest of this section. Nonetheless, it is interesting to see how it is defined and why this definition works.

  One can think of $ A + B $ consisting of elements $ t \bullet (a + b) $ for $ t: T_{m + n} $, $ a : A^m $ and $ b: B^n $ (writing $ (a + b) $ for $ (a_1, \dots, a_m, b_1, \dots, b_n) $), `substituting' the $ a_i $ and $ b_j $ for the $ x_i $ and $ x_{m + j} $ in $ t $.

  However, the coend is a quotient of $ \coprod T_{m + n} \times A^m \times B^n $ along some relations. These relations then give `associativity' of this substitution $ t \bullet (a + b) $. In particular, they assure that reordering or duplicating $ x_i $ and their corresponding $ a_i $ and $ b_j $ do not yield different elements. For $ f: \mathbf L(m, m^\prime) = T_m^{m^\prime} $, $ g: \mathbf L(n, n^\prime) = T_n^{n^\prime} $, associating the images on the left and right of
  \[ T_{m^\prime + n^\prime} \times A^{m^\prime} \times B^{n^\prime} \leftarrow T_{m^\prime + n^\prime} \times A^m \times B^n \rightarrow T_{m + n} \times A^m \times B^n \]
  gives
  \[ t \bullet ((f_i \bullet a)_i + (g_j \bullet b)_j) = (t \bullet ((f_i \bullet (x_{m + n, j})_j)_i + (g_i \bullet (x_{m + n, m + j})_j)_i)) \bullet (a + b) \]
  for $ t : T_{m^\prime + n^\prime} $, $ a : A^m $ and $ b : B^n $.

  Then it becomes clear what the action of $ T $ will be on $ A + B $, although the precise definition looks complicated because we have to juggle a bit with the variables in the different $ T_{m + n} $. For $ s : T_l $, $ t_i : T_{m_i + n_i} $, $ a_i : A^{m_i} $ and $ b_i : B^{n_i} $, define the disjoint embeddings
  \[ d_i : \left\llbracket m_i + n_i \right\rrbracket \cong \left\llbracket m_i \right\rrbracket \sqcup \left\llbracket n_i \right\rrbracket \hookrightarrow \left\llbracket \sum_j m_j \right\rrbracket \sqcup \left\llbracket \sum_j n_j \right\rrbracket \cong \left\llbracket \sum_j m_j + \sum_j n_j \right\rrbracket, \]
  which we will use to make sure that the $ x_j $ in the different $ t_i $ are mapped to distinct variables. Then we can define
  \[ s \bullet (t_i \bullet a_i + b_i) = (s \bullet (t_i \bullet (x_{d_i(j)})_j)_i) \bullet (a_1 + b_1 + \dots + a_l + b_l). \]
  More formally (using the coend injections $ A^{\sum_k m_k} \times B^{\sum_k n_k} \times T_{\sum_k m_k + \sum_k n_k} \to A + B $), this gives functions
  \[ T_l \to (A^{m_1} \times B^{n_1} \times T_{m_1 + n_1} \to (\dots \to (A^{m_l} \times B^{n_l} \times T_{m_l + n_l} \to A + B) \dots )), \]
  commuting with the relations between the different $ (A^m \times B^n \times T_{m + n}) $, which, by repeatedly using the universal property of the coend, then correspond to functions
  \[ T_l \to (A + B \to (\dots \to (A + B \to A + B) \dots )), \]
  or, equivalently, a function
  \[ T_l \times (A + B)^l \to A + B. \]

  We have left and right injections $ A \to A + B $ and $ B \to A + B $, given respectively by the maps $ A^1 \times B^0 \times T_{1 + 0} \to A + B $ and $ A^0 \times B^1 \times T_{0 + 1} \to A + B $:
  \[ a \mapsto x_1 \bullet a \quad \text{and} \quad b \mapsto x_1 \bullet b \]
  and every element $ A + B $ arises by the action of $ t $ on combinations of these embedded elements:
  \[ t \bullet (a + b) = t \bullet ((x_1 \bullet a_i)_i + (x_1 \bullet b_j)_j), \]
  which ultimately can be used to show that $ A + B $ indeed has the universal property of the coproduct.
\end{proof}

\begin{definition}
  Let $ T $ be an algebraic theory and $ A $ a $ T $-algebra. We can define an algebraic theory $ T_A $ called the \iindex{theory of extensions} of $ A $' with $ (T_A)_n = A + T_n $. The right injection of the variables $ x_i : T_n $ gives the variables.

  For $ h: (A + T_n)^m $, sending $ g: T_m $ to $ g \bullet h $ gives a $ T $-algebra morphism $ T_m \to T_n + A $. Together with the right injection morphism of $ A $ into $ T_n + A $, this gives us a $ T $-algebra morphism from the coproduct: $ T_m + A \to T_n + A $. Doing this for every $ h: (A + T_n)^m $ gives us the substitution $ (T_m + A) \times (T_n + A)^m \to T_n + A $.

  Showing that this is indeed an algebraic theory involves invoking the universal property of the coproduct and using properties of $ T $-algebras and $ T $-algebra morphisms.
\end{definition}

\begin{remark}[\coqident{AlgebraicTheories.Examples.ExtensionsTheory}{extensions_theory}]
  We can turn the map $ A \mapsto T_A $ into a functor $ T_- : \Alg T \to \AlgTh $. For a morphism $ f: \Alg T(A, B) $, we get maps
  \[ f + \id{T_n} : \Alg T(A + T_n, B + T_n). \]
  We can combine these into a morphism $ T_f = (f + \id{T_n})_n $, and this makes $ T_- $ into a functor from $ \Alg T $ to $ \AlgTh $.

  To actually show that $ T_f $ is a morphism and that $ T_- $ is a functor, we use the properties of the coproduct a couple of times, as well as the fact that $ f + \id{T_n} : \Alg T(A + T_n, B + T_n) $ preserves the $ T $-action.
\end{remark}

\begin{remark}
  Note that for a $ T $-algebra morphism $ f: A \to B $, we have morphisms $ f: A + T_n \xrightarrow{f + \id{T_n}} B + T_n $.
\end{remark}

\begin{remark}
  Note that the right embeddings $ r_n : T_n \to A + T_n $ give an algebraic theory morphism $ (r_n)_n : T \to T_A $, so we can think of $ T $ as lying inside $ T_A $.
\end{remark}

The following result explains why we are interested in the theory of extensions:
\begin{lemma}[\coqident{AlgebraicTheories.Examples.ExtensionsTheory}{algebra_coslice_equivalence}]\label{lem:extensions-algebra-coslice}
  For $ T $ an algebraic theory and $ A $ a $ T $-algebra, we have an adjoint equivalence $ \Alg{T_A} \cong (A \downarrow \Alg T) $ between algebras for $ T_A $ and the coslice category under $ A $.
\end{lemma}
\begin{proof}
  Let $ B $ be a $ T_A $-algebra. Pullback along the embedding $ (r_n)_n : T \to T_A $ gives $ (r_n)_n^*(B) : \Alg T $. Also, we have a $ T $-algebra morphism $ A \to B $ given by the composition
  \[ A \to (T_A)_0 \xrightarrow{f \mapsto f \bullet ()} B. \]

  Conversely, take $ f: \Alg T(A, B) $. For $ b: B^n $, we have a $ T $-algebra morphism $ T_n \to B $ given by $ f \mapsto f \bullet b $. This, together with $ f $, gives a morphism from the coproduct $ A + T_n \to B $, and doing this for every $ b: B^n $ gives a $ T_A $-action on $ B $ as functions $ (A + T_n) \times B^n \to B $.

  Now, showing that the function $ A \to (T_A)_0 \to B $ defined above is indeed a $ T $-algebra morphism and that the other $ B $, together with the given $ T_A $-action is indeed a $ T_A $-algebra, and furthermore showing that these extend to functors that together form an adjoint equivalence, involves checking a lot of details. One can indeed check that all of this holds, using the properties of algebraic theories, algebras, algebra morphisms and coproducts, as well as the fact that for all $ b : B^n $, $ f \mapsto f \bullet b $ is a morphism in $ \Alg T(A + T_n, (r_n)_n^*(B)) $. However, for the sake of brevity, we will omit these and point to the formalization for the details.
\end{proof}

\begin{example}
  Take $ T_n = Z[X_1, \dots, X_n] $, the polynomial ring (the free commutative ring) in $ n $ variables. $ T $-algebras are equivalent to commutative rings, so we can call $ T $ `the theory of commutative rings'. Now, for a commutative ring $ R $, $ \Alg{T_R} $ is equivalent to the coslice category $ (R \downarrow \Alg T) $, which is the category of $ R $-algebras. Therefore, the theory of extensions $ T_R $ can be considered to be the theory of $ R $-algebras.
\end{example}

\begin{lemma}[\coqident{AlgebraicTheories.Examples.ExtensionsTheory}{factorization}]\label{lem:factor-through-extensions}
  Any algebraic theory morphism $ f: \AlgTh(S, T) $ factors through the embedding of $ S $ into the theory of extensions of the pullback of the algebra $ T_0 $:
  \begin{center}
    \begin{tikzcd}
      S \arrow[r] \arrow[rr, bend right, "f"'] & S_{f^*(T_0)} \arrow[r] & T
    \end{tikzcd}
  \end{center}
\end{lemma}
\begin{proof}
  For any $ n $, we have a map of $ S $-algebras $ [t \mapsto t \bullet (), f_n] : f^*(T_0) + S_n \to f^*(T_n) $, given on $ f^*(T_0) $ by $ t \mapsto t \bullet () $ and on $ S_n $ by $ f_n $. By the universal property of the coproduct, the following diagram commutes for all $ n $:
  \begin{center}
    \begin{tikzcd}[sep = large]
      S_n \arrow[r, "r_n"] \arrow[rr, bend right, "f_n"'] & f^*(T_0) + S_n \arrow[r, "{[t \mapsto t \bullet (), f_n]}"] & T
    \end{tikzcd}
  \end{center}
  which shows that $ (r_n)_n \cdot [f \mapsto f \bullet (), f_n]_n = f $.

  Now, to show that $ [f \mapsto f \bullet (), f_n]_n $ indeed constitutes an algebraic theory morphism is a bit more work. It involves using the universal property of the coproduct a couple of times, as well as showing that for all $ g : S_{f^*(T_0)}^n $,
  \[ s \mapsto ([t \mapsto t \bullet (), f_m] x) \bullet_T ([t \mapsto t \bullet (), f_n] g_i)_i \]
  is a morphism in $ \Alg S(f^*(T_0) + T_m, f^*(T_n)) $. For more details, we again point to the formalization.
\end{proof}

Now, given a $ \Lambda $-algebra $ A $, applying the above to the initial morphism $ \iota_\Lambda : \Lambda \to E_{\R_A}(U) $, we get the following diagram:
\begin{center}
  \begin{tikzcd}[sep = large]
    \Lambda \arrow[r] & \Lambda_{E_{\R_A}(U)_0} \arrow[r, "{[t \mapsto t \bullet_{E_{\R_A}(U)} (), \iota_{\Lambda_n}]_n}"] \arrow[d, "\Lambda_{\epsilon_A}"] & E_{\R_A}(U)\\
    & \Lambda_A
  \end{tikzcd}
\end{center}
For the final form of the fundamental theorem, we need to show that
\[ \Lambda_{\epsilon_A^{-1}} \cdot [t \mapsto t \bullet_{E_{\R_A}(U)} (), \iota_{\Lambda_n}]_n = [a \mapsto \epsilon_A^{-1}(a) \bullet_{E_{\R_A}(U)} (), \iota_{\Lambda_n}]_n \]
is an isomorphism of algebraic theories. By Lemma \ref{lem:factor-through-extensions}, this is equivalent to its pullback
\[ [a \mapsto \epsilon_A^{-1}(a) \bullet_{E_{\R_A}(U)} (), \iota_{\Lambda_n}]_n^* : \Alg{E_{\R_A}(U)} \to \Alg{\Lambda_A} \]
being an equivalence of categories.

\begin{lemma}
  The isomorphisms $ \epsilon_A : E_{\R_A}(U)_0 \xrightarrow \sim A $ form a natural transformation. That is, for all $ h: \Alg \Lambda(A, B) $, the following diagram commutes:
  \begin{center}
    \begin{tikzcd}
      E_{\R_A}(U)_0 \arrow[r, "h"] \arrow[d, "\epsilon_A"] & E_{\R_B}(U)_0 \arrow[d, "\epsilon_B"]\\
      A \arrow[r, "h"] & B
    \end{tikzcd}
  \end{center}
\end{lemma}
\begin{proof}
  This follows from simple unfolding and using the property of algebra morphisms: For all $ f: E_{\R_A}(U)_0 = \{ f : A \mid (x_1 \circ I_c) \bullet_A f = f \} $,
  \begin{align*}
    \epsilon_B(h(f))
    &= (x_1 c_1) \bullet_B h(f)\\
    &= h((x_1 c_1) \bullet_A f)\\
    &= h(\epsilon_A(f)).
  \end{align*}
\end{proof}

\begin{lemma}\label{lem:pullback-essentially-surjective}
  The pullback functor
  \[ [a \mapsto \epsilon_A^{-1}(a) \bullet_{E_{\R_A}(U)} (), \iota_{\Lambda_n}]_n^* \]
  is essentially surjective.
\end{lemma}
\begin{proof}
  Take $ B : \Alg{\Lambda_A} $. By Lemma \ref{lem:extensions-algebra-coslice} we can consider $ B $ to be a object in the coslice category $ h : \Alg{\Lambda}(A, B) $. As shown in Section \ref{sec:elementary-fundamental-theorem}, $ h $ sends elements in $ \R_A(U^n, U) $ to elements in $ \R_B(U^n, U) $, so we can regard it as a morphism $ (h)_n: \AlgTh(E_{\R_A}(U), E_{\R_B}(U)) $. We then have a $ E_{\R_A}(U) $-algebra $ (h)_n^*(E_{\R_B}(U)_0) $. Now we need to prove that we have an isomorphism of $ \Lambda_A $-algebras
  \[ ([a \mapsto \epsilon_A^{-1}(a) \bullet (), \iota_{\Lambda_n}]_n \cdot (h)_n)^*(E_{\R_B}(U)_0) \cong B. \]
  Under the equivalence in Lemma \ref{lem:extensions-algebra-coslice}, this pullback of $ E_{\R_B}(U)_0 $ corresponds to some $ (B^\prime, h^\prime) : (A \downarrow \Alg \Lambda) $. The set of $ B^\prime $ is $ \R_B(I, U) $, its $ \Lambda $-action is given by
  \[ (f, b) \mapsto h(\iota_{\Lambda_n}(f)) \bullet_{E_{\R_B}(U)} b, \]
  and the morphism $ h^\prime $ is given by $ h^\prime(a) = h(\epsilon_A^{-1}(a)) $. Note that by initiality of $ \Lambda $, the following diagram of algebraic theories commutes
  \begin{center}
    \begin{tikzcd}
      & \Lambda \arrow[ld, "\iota_\Lambda"'] \arrow[rd, "\iota_\Lambda"]\\
      E_{\R_A}(U) \arrow[rr, "(h)_n"] && E_{\R_B}(U)
    \end{tikzcd}
  \end{center}
  Therefore, $ h(\iota_{\Lambda_n}(f)) = \iota_{\Lambda_n}(f) $, so the $ \Lambda $-action on $ B^\prime $ is exactly the action on $ \iota_\Lambda^*(E_{\R_B}(U)_0) $, which means that $ B^\prime = \iota_\Lambda^*(E_{\R_B}(U)_0) $. We have the following diagram in $ \Alg \Lambda $:
  \begin{center}
    \begin{tikzcd}[sep = large]
      & A \arrow[ld, "a \mapsto h(\epsilon_A^{-1}(a))"'] \arrow[rd, "h"]\\
      E_{\R_B}(U)_0 \arrow[rr, "\epsilon_B", "\sim"'] & & B
    \end{tikzcd}
  \end{center}
  By naturality of $ \epsilon $, this diagram commutes, which shows that $ \epsilon_B $ is an isomorphism in the coslice category under $ A $. Pulling this isomorphism back along the equivalence from Lemma \ref{lem:extensions-algebra-coslice} gives an isomorphism of $ \Lambda_A $-algebras
  \[ ([a \mapsto \epsilon_A^{-1}(a) \bullet (), \iota_{\Lambda_n}]_n \cdot h)^*(E_{\R_B}(U)_0) \cong B \]
  and this concludes the proof.
\end{proof}

\begin{lemma}
  For $ \iota_\Lambda: \LamTh(\Lambda, E_{\R_A}(U)) $ and $ s_i : \Lambda_n $, we have
  \[ \iota_\Lambda((s_i)_i) = \langle x_i \rangle_i \bullet_A (\iota_\Lambda(s_i))_i. \]
\end{lemma}
\begin{proof}
  By the recursive nature of the definitions of $ (s_i)_i $ and $ \langle x_i \rangle_i $, it suffices to show that for $ a, b : \Lambda_n $, $ \iota_\Lambda((a, b)) = \langle x_1, x_2 \rangle \bullet_A (\iota_\Lambda(a), \iota_\Lambda(b)) $ and that $ \iota_\Lambda(c_n) = I_c \bullet_A () $. Since $ \iota_\Lambda $ is defined via structural induction, this is just a matter of straightforward but tedious unfolding and rewriting, at some point using the fact that $ (x_1 \circ U^n) \bullet_A \iota_\Lambda(a) = \iota_\Lambda(a) $:
  \begin{align*}
    \iota_\Lambda((a, b))
    &= \iota_\Lambda(\lambda x_{n + 1}, x_{n + 1} \iota_{n, n + 1}(a) \iota_{n, n + 1}(b))\\
    &= (\lambda x_2 x_3, x_1 (x_2, x_3)) \bullet_A \iota_\Lambda(x_{n + 1} \iota_{n, n + 1}(a) \iota_{n, n + 1}(b))\\
    &= (\lambda x_4 x_5, (\lambda x_6, x_1 x_6 (x_2 x_6) (x_3 x_6)) (x_4, x_5)) \bullet_A (\iota_\Lambda(x_{n + 1}), \iota_\Lambda(a \bullet_\Lambda (x_{n + 1, i})_i), \iota_\Lambda(b \bullet_\Lambda (x_{n + 1, i})_i))\\
    &= (\lambda x_3 x_4, \pi_{n + 1, n + 1} (x_3, x_4) ((x_1 \circ \langle \pi_{n + 1, i} \rangle)_i (x_3, x_4)) ((x_2 \circ \langle \pi_{n + 1, i} \rangle)_i (x_3, x_4))) \bullet_A (\iota_\Lambda(a), \iota_\Lambda(b))\\
    &= (\lambda x_3 x_4, x_4 ((x_1 \circ \langle \pi_{n, i} \rangle_i) x_3) ((x_2 \circ \langle \pi_{n, i} \rangle_i) x_3)) \bullet_A (\iota_\Lambda(a), \iota_\Lambda(b))\\
    &= (\lambda x_3 x_4, x_4 (x_1 x_3) (x_2 x_3)) \bullet_A (\iota_\Lambda(a), \iota_\Lambda(b))\\
    &= \langle x_1, x_2 \rangle \bullet_A (\iota_\Lambda(a), \iota_\Lambda(b))
  \end{align*}
  and
  \begin{align*}
    \iota_\Lambda(c_n)
    &= \iota_\Lambda(\lambda x_{n + 1}, x_{n + 1})\\
    &= (\lambda x_2 x_3, x_1 (x_2, x_3)) \bullet_A \iota_\Lambda(x_{n + 1})\\
    &= (\lambda x_1 x_2, \pi_{n + 1, n + 1} (x_1, x_2)) \bullet_A ()\\
    &= (\lambda x_1 x_2, x_2) \bullet_A ()\\
    &= I_c \bullet_A ().
  \end{align*}
\end{proof}

\begin{remark}\label{rem:endomorphism-theory-algebra-to-endomorphism-theory-algebra}
  Note that for any $ E_{\R_A}(U) $-algebra $ B $, we can view the pullback $ \Lambda_A $-algebra $ [a \mapsto \epsilon_A^{-1}(a) \bullet_{E_{\R_A}(U)} (), \iota_{\Lambda_n}]^* B $ as an object in the coslice category under $ A $, given by
  \[ a \mapsto \epsilon_A^{-1}(a) \bullet_B () : \Alg \Lambda(A, \iota_\Lambda^* B). \]
  Functoriality of the endomorphism theory construction of $ U : \R_A $ and $ U : \R_{\iota_\Lambda^* B} $, gives a $ \lambda $-theory morphism
  \[ a \mapsto \epsilon_A^{-1}(a) \bullet_B (): \LamTh(E_{\R_A}(U), E_{\R_{\iota_\Lambda^* B}}(U)). \]
  Then, we can pull back the theory algebra along this morphism, to get, again a $ E_{\R_A}(U) $-algebra
  \[ (a \mapsto \epsilon_A^{-1}(a) \bullet_B ())^* (E_{\R_{\iota_\Lambda^* B}}(U)_0). \]
\end{remark}

\begin{lemma}
  For $ B : \Alg {E_{\R_A}(U)} $, we have an isomorphism of $ E_{\R_A}(U) $-algebras given by
  \[ \epsilon_{\iota_\Lambda^* B} : (a \mapsto \epsilon_A^{-1}(a) \bullet_B ())^* (E_{\R_{\iota_\Lambda^* B}}(U)_0) \xrightarrow \sim B. \]
\end{lemma}
\begin{proof}
  Note that the underlying set of $ (a \mapsto \epsilon_A^{-1}(a) \bullet_B ())^* (E_{\R_{\iota_\Lambda^* B}}(U)_0) $ is $ \R_{\iota_\Lambda^* B}(I, U) $, and that $ \epsilon_{\iota_\Lambda^* B} $ is a bijection between this set and $ B $. Now we only need to show that it is a morphism of $ E_{\R_A}(U) $-algebras. Take $ s: E_{\R_A}(U)_n $ and all $ b : E_{\R_{\iota_\Lambda^* B}}(U)_0^n $. We have
  \begin{align*}
    \epsilon_{\iota_\Lambda^* B}(s \bullet b)
    &= \iota_\Lambda(x_1 c_1) \bullet_B ((\epsilon_A^{-1}(s) \bullet_B ()) \bullet_{E_{\R_{\iota_\Lambda^* B}}(U)_0} b)\\
    &= \iota_\Lambda(x_1 c_1) \bullet_B (\iota_\Lambda(x_1 \circ \langle x_2, \dots, x_{n + 1} \rangle) \bullet_B (\epsilon_A^{-1}(s) \bullet_B (), b_1, \dots, b_n))\\
    &= \iota_\Lambda(x_1 c_1) \bullet_B ((\iota_\Lambda(x_1 \circ \langle x_{i + 1} \rangle_i) \bullet_{E_{\R_A}(U)} (\epsilon_A^{-1}(s), \iota_\Lambda(x_1), \dots, \iota_\Lambda(x_n))) \bullet_B b)\\
    &= (\iota_\Lambda(x_1 c_1) \bullet_{E_{\R_A}(U)} (\iota_\Lambda(x_1 \circ \langle x_{i + 1} \rangle_i) \bullet_{E_{\R_A}(U)} (\epsilon_A^{-1}(s), \iota_\Lambda(x_1), \dots, \iota_\Lambda(x_n)))) \bullet_B b\\
    &= (\iota_\Lambda(x_1 (x_{i + 1} c_{n + 1})_i) \bullet_{E_{\R_A}(U)} (\epsilon_A^{-1}(s), \iota_\Lambda(x_1), \dots, \iota_\Lambda(x_n))) \bullet_B b\\
    &= (\iota_\Lambda(x_1 x_2) \bullet_{E_{\R_A}(U)} (\epsilon_A^{-1}(s), \iota_\Lambda((x_i c_n)_i))) \bullet_B b\\
    &= ((\iota_\Lambda(x_1 x_2) \bullet_{E_{\R_A}(U)} (\epsilon_A^{-1}(s), \iota_\Lambda((x_i)_i))) \bullet_{E_{\R_A}(U)} (x_i c_n)_i) \bullet_B b\\
  \end{align*}
  Also,
  \begin{align*}
    s \bullet_B (\epsilon_B(b_i))_i
    &= s \bullet_B (\iota_\Lambda(x_1 c_1) \bullet_B b_i)_i\\
    &= s \bullet_B (\iota_\Lambda(x_i c_n) \bullet_B (b_j)_j)_i\\
    &= (s \bullet_{E_{\R_A}(U)} (\iota_\Lambda(x_i c_n))_i) \bullet_B b.
  \end{align*}
  Then the result follows from the fact that
  \begin{align*}
    \iota_\Lambda(x_1 x_2) \bullet_{E_{\R_A}(U)} (\epsilon_A^{-1}(s), \iota_\Lambda((x_i)_i))
    &= \iota_\Lambda(x_1 x_2) \bullet_{E_{\R_A}(U)} ((\lambda x_2, x_1) \bullet_A s, \langle x_i \rangle_i \bullet_A (\iota_\Lambda(x_i))_i)\\
    &= (\lambda x_3, x_1 x_3 x_2 x_3) \bullet_A ((\lambda x_2, x_1) \bullet_A s, \langle x_i \rangle_i \bullet_A (\pi_{n, i} \bullet_A ())_i)\\
    &= (\lambda x_3, x_1 x_2 x_3) \bullet_A (s, \langle \pi_{n, i} \rangle_i \bullet_A ())\\
    &= (x_1 \circ x_2) \bullet_A (s, U^n \bullet_A ())\\
    &= s.
  \end{align*}
\end{proof}

\begin{lemma}\label{lem:pullback-fully-faithful}
  $ [a \mapsto \epsilon_A^{-1}(a) \bullet (), \iota_{\Lambda_n}]_n^* $ is fully faithful.
\end{lemma}
\begin{proof}
  First of all, note that the pullback functor is always faithful, since it preserves all the `data' (i.e. the functions) of the algebra morphisms.

  Now, to show that it is full, take $ B, C: \Alg{E_{\R_A}(U)} $. Also, take a morphism
  \[ h : \Alg{\Lambda_A}([a \mapsto \epsilon_A^{-1}(a) \bullet_B (), \iota_{\Lambda_n}]_n^* B, [a \mapsto \epsilon_A^{-1}(a) \bullet_C (), \iota_{\Lambda_n}]_n^* C). \]
  By Remark \ref{rem:endomorphism-theory-algebra-to-endomorphism-theory-algebra}, and by functoriality of the endomorphism theory construction, we get a commutative diagram
  \begin{center}
    \begin{tikzcd}
      & E_{\R_A}(U) \arrow[ld, "a \mapsto \epsilon_A^{-1}(a) \bullet_B ()"'] \arrow[rd, "a \mapsto \epsilon_A^{-1}(a) \bullet_C ()"]\\
      E_{\R_{\iota_{\Lambda}^* B}}(U) \arrow[rr, "(h)_n"] & & E_{\R_{\iota_{\Lambda}^* C}}(U)
    \end{tikzcd}
  \end{center}
  Now, using Definition \ref{def:theory-algebra-pullback-functor} for the coslice category $ (E_{\R_A}(U) \downarrow \AlgTh) $, and using the previous lemma, we get the following diagram of $ E_{\R_A}(U) $-algebras:
  \begin{center}
    \begin{tikzcd}[sep = large]
      (a \mapsto \epsilon_A^{-1}(a) \bullet_B ())^* (E_{\R_{\iota_\Lambda^* B}}(U)_0)
        \arrow[r, "(a \mapsto \epsilon_A^{-1}(a) \bullet ())^* h"]
        \arrow[d, "\epsilon_{\iota_\Lambda^* B}", "\sim"'] &
      (a \mapsto \epsilon_A^{-1}(a) \bullet_C ())^* (E_{\R_{\iota_\Lambda^* C}}(U)_0)
        \arrow[d, "\epsilon_{\iota_\Lambda^* C}", "\sim"']\\
      B \arrow[r, dashed, "\bar h"] & C
    \end{tikzcd}
  \end{center}
  This gives us the lift
  \[ \bar h = \epsilon_{\iota_\Lambda^* B}^{-1} \cdot (a \mapsto \epsilon_A^{-1}(a) \bullet ())^* h \cdot \epsilon_{\iota_\Lambda^* C} : \Alg{E_{\R_A}(U)}(B, C) \]

  Now, when we again pull back this map to
  \[ [a \mapsto \epsilon_A^{-1}(a) \bullet (), \iota_{\Lambda_n}]_n^* \bar h : \Alg{\Lambda_A}([a \mapsto \epsilon_A^{-1}(a) \bullet (), \iota_{\Lambda_n}]_n^* B, [a \mapsto \epsilon_A^{-1}(a) \bullet (), \iota_{\Lambda_n}]_n^* C). \]
  Note that by naturality of $ \epsilon $, we have
  \[ \bar h = \epsilon_{\iota_\Lambda^* B}^{-1} \cdot h \cdot \epsilon_{\iota_\Lambda^* C} = \epsilon_{\iota_\Lambda^* B}^{-1} \cdot \epsilon_{\iota_\Lambda^* B} \cdot h = h \]
  as functions, and therefore $ [a \mapsto \epsilon_A^{-1}(a) \bullet (), \iota_{\Lambda_n}]_n^* \bar h = h $, so the pullback is full.
\end{proof}

\begin{lemma}
  $ \Lambda_A $ is isomorphic to $ E_{\R_A}(U) $ as an algebraic theory.
\end{lemma}
\begin{proof}
  By Lemmas \ref{lem:pullback-essentially-surjective} and  \ref{lem:pullback-fully-faithful}, the pullback functor $ [a \mapsto \epsilon_A^{-1}(a) \bullet (), \iota_{\Lambda_n}]_n^* $ is a weak equivalence. Since algebra categories are univalent, this means that the pullback functor is an equivalence of categories. Then, by Lemma \ref{lem:algebra-pullback-equivalence}, $ [a \mapsto \epsilon_A^{-1}(a) \bullet (), \iota_{\Lambda_n}]_n : \AlgTh(\Lambda_A, E_{\R_A}(U)) $ is an isomorphism.
\end{proof}

Now, to show that we can replace the functor $ A \mapsto E_{\R_A}(U) $ by $ A \mapsto \Lambda_A $, we can show that the functors are isomorphic:

\begin{lemma}
  The isomorphisms $ [a \mapsto \epsilon_A^{-1}(a) \bullet_{E_{\R_A}(U)} (), \iota_{\Lambda_n}]_n : \AlgTh(\Lambda_A, E_{\R_A}(U)) $ form a natural isomorphism between the functors
  \[ A \mapsto E_{\R_A}(U), \quad h \mapsto (h)_n \quad \text{and} \quad A \mapsto \Lambda_A, \quad h \mapsto \Lambda_h. \]
\end{lemma}
\begin{proof}
  We must show that for all $ h: \Alg \Lambda(A, B) $ and for all $ n $, the following diagram of $ \Lambda $-algebras commutes:
  \begin{center}
    \begin{tikzcd}[sep = large]
      A + \Lambda_n
        \arrow[d, "h + \id{\Lambda_n}"']
        \arrow[rr, "{[a \mapsto \epsilon_A^{-1}(a) \bullet (), \iota_{\Lambda_n}]}"]
      && \iota_\Lambda^*(E_{\R_A}(U)_n)
        \arrow[d, "h"]
      \\ B + \Lambda_n
        \arrow[rr, "{[a \mapsto \epsilon_B^{-1}(a) \bullet (), \iota_{\Lambda_n}]}"']
      && \iota_\Lambda^*(E_{\R_B}(U)_n)
    \end{tikzcd}
  \end{center}
  Now, by the universal property of the coproduct $ A + \Lambda_n $, it suffices to check that for all $ a : A $ and $ t : \Lambda_n $,
  \[ h(\epsilon_A^{-1}(a) \bullet_{E_{\R_A}(U)} ()) = \epsilon_B^{-1}(h(a)) \bullet_{E_{\R_B}(U)} () \quad \text{and} \quad h(\iota_{\Lambda_n}(a)) = \iota_{\Lambda_n}(a). \]
  The former follows from the fact that $ (h)_n : \LamTh(E_{\R_A}(U), E_{\R_B}(U)) $ respects the substitution and from the naturality of $ \epsilon^{-1} $:
  \[ h(\epsilon_A^{-1}(a) \bullet_{E_{\R_A}(U)} ())
    = h(\epsilon_A^{-1}(a)) \bullet_{E_{\R_B}(U)} ()
    = \epsilon_B^{-1}(h(a)) \bullet_{E_{\R_B}(U)} (), \]
  whereas the latter follows from the initiality of $ \Lambda $, and the fact that $ (h)_n : E_{\R_A}(U) \to E_{\R_B}(U) $ is a $ \lambda $-theory morphism.
\end{proof}

\begin{remark}
  Now, note that for any $ \Lambda $-algebra $ A $, $ \Lambda_A $ is an algebraic theory. However, for our equivalence of categories, we need a functor to the category of $ \lambda $-theories. By the natural isomorphism above (which respects the algebraic theory structures), we see that the objects and morphisms in the images of $ E_{\R_-}(U) $ and $ \Lambda_- $ have `the same' algebraic theory structures, and we can transfer the additional $ \lambda $-theory structures from $ E_{\R_-}(U) $ to $ \Lambda_- $. With some abuse of notation, this yields a functor $ \Lambda_- : \Alg \Lambda \to \LamTh $.
\end{remark}

The final form of Hyland's representation theorem is the following:
\begin{theorem}\label{thm:final-fundamental-theorem}
  The functor that sends a $ \lambda $-theory $ L $ to the $ \Lambda $-algebra $ L_0 $ and the functor that sends a $ \Lambda $-algebra $ A $ to the theory of extensions $ \Lambda_A $ form an adjoint equivalence
  \[ \LamTh \cong \Alg \Lambda. \]
\end{theorem}
\begin{proof}
  By \ref{thm:Hyland-fundamental-theorem}, we have an adjoint equivalence given by
  \[ L \mapsto L_0 \quad \text{and} \quad A \mapsto E_{\R_A}(U). \]
  By the previous lemma, the second functor is isomorphic to $ \Lambda_-: \Alg \Lambda \to \LamTh $. Therefore, we can replace one by the other.

  There are two ways to see this: We may notice that we can transfer the unit, the counit and the two zigzag identities of the adjunction along the natural isomorphism and show that this all works together. As an alternative, we can also notice that the category of $ \lambda $-theories is univalent, so the functor category $ \Alg \Lambda \to \LamTh $ is univalent and the natural isomorphism between the functors is an equality, and we can replace one by the other.
\end{proof}
